!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vl=e()}}(function(){var e;return function t(e,n,a){function i(o,u){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!u&&c)return c(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var s=n[o]={exports:{}};e[o][0].call(s.exports,function(t){var n=e[o][1][t];return i(n?n:t)},s,s.exports,t,e,n,a)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(e,t,n){},{}],2:[function(t,n,a){!function(t,i){"object"==typeof a&&"undefined"!=typeof n?i(a):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,a,o){function u(t){return e(t=new Date(+t)),t}return u.floor=u,u.round=function(t){var a=new Date(+t),i=new Date(t-1);return e(a),e(i),n(i,1),i-t>t-a?a:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},u.range=function(t,a,i){var r=[];if(t=new Date(t-1),a=new Date(+a),i=null==i?1:Math.floor(i),!(a>t&&i>0))return r;for(n(t,1),e(t),a>t&&r.push(new Date(+t));n(t,i),e(t),a>t;)r.push(new Date(+t));return r},u.filter=function(a){return t(function(t){for(;e(t),!a(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!a(e););})},a&&(u.count=function(t,n){return i.setTime(+t),r.setTime(+n),e(i),e(r),Math.floor(a(i,r))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(o?function(t){return o(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function a(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,r=new Date,o=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});o.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):o:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),c=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),l=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),s=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),f=n(0),d=n(1),p=n(2),m=n(3),h=n(4),g=n(5),y=n(6),O=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),T=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),v=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),E=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),S=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),A=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),N=a(0),M=a(1),R=a(2),L=a(3),C=a(4),x=a(5),b=a(6),D=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),I=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),U=o.range,k=u.range,_=c.range,Y=l.range,w=s.range,P=f.range,F=d.range,H=p.range,X=m.range,z=h.range,G=g.range,W=y.range,V=f.range,Z=O.range,Q=T.range,B=o,j=U,q=v.range,K=E.range,$=S.range,J=A.range,ee=N.range,te=M.range,ne=R.range,ae=L.range,ie=C.range,re=x.range,oe=b.range,ue=N.range,ce=D.range,le=I.range,se="0.1.1";e.version=se,e.milliseconds=U,e.seconds=k,e.minutes=_,e.hours=Y,e.days=w,e.sundays=P,e.mondays=F,e.tuesdays=H,e.wednesdays=X,e.thursdays=z,e.fridays=G,e.saturdays=W,e.weeks=V,e.months=Z,e.years=Q,e.utcMillisecond=B,e.utcMilliseconds=j,e.utcSeconds=q,e.utcMinutes=K,e.utcHours=$,e.utcDays=J,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=ae,e.utcThursdays=ie,e.utcFridays=re,e.utcSaturdays=oe,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=le,e.millisecond=o,e.second=u,e.minute=c,e.hour=l,e.day=s,e.sunday=f,e.monday=d,e.tuesday=p,e.wednesday=m,e.thursday=h,e.friday=g,e.saturday=y,e.week=f,e.month=O,e.year=T,e.utcSecond=v,e.utcMinute=E,e.utcHour=S,e.utcDay=A,e.utcSunday=N,e.utcMonday=M,e.utcTuesday=R,e.utcWednesday=L,e.utcThursday=C,e.utcFriday=x,e.utcSaturday=b,e.utcWeek=N,e.utcMonth=D,e.utcYear=I,e.interval=t})},{}],3:[function(e,t,n){function a(e){if(!e)throw Error("Missing binning options.");var t,n,a,u,c,l,s,f=e.maxbins||15,d=e.base||10,p=Math.log(d),m=e.div||[5,2],h=e.min,g=e.max,y=g-h;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,y/f,0,e.steps.length))];else{for(n=Math.ceil(Math.log(f)/p),a=e.minstep||0,t=Math.max(a,Math.pow(d,Math.round(Math.log(y)/p)-n));Math.ceil(y/t)>f;)t*=d;for(l=0;l<m.length;++l)c=t/m[l],c>=a&&f>=y/c&&(t=c)}return c=Math.log(t),u=c>=0?0:~~(-c/p)+1,s=Math.pow(d,-u-1),h=Math.min(h,Math.floor(h/t+s)*t),g=Math.ceil(g/t)*t,{start:h,stop:g,step:t,unit:{precision:u},value:r,index:o}}function i(e,t,n,a){for(;a>n;){var i=n+a>>>1;l.cmp(e[i],t)<0?n=i+1:a=i}return n}function r(e){return this.step*Math.floor(e/this.step+f)}function o(e){return Math.floor((e-this.start)/this.step+f)}function u(e){return this.unit.date(r.call(this,e))}function c(e){return o.call(this,this.unit.unit(e))}var l=e("../util"),s=e("../time"),f=1e-15;a.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?s.utc:s,n=e.min,i=e.max,r=e.maxbins||20,o=e.minbins||4,l=+i-+n,f=e.unit?t[e.unit]:t.find(l,o,r),d=a({min:null!=f.min?f.min:f.unit(n),max:null!=f.max?f.max:f.unit(i),maxbins:r,minstep:f.minstep,steps:f.step});return d.unit=f,d.index=c,e.raw||(d.value=u),d},t.exports=a},{"../time":5,"../util":6}],4:[function(e,t,n){var a=e("./util"),i=t.exports;i.repeat=function(e,t){var n,a=Array(t);for(n=0;t>n;++n)a[n]=e;return a},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var a,i=[],r=-1;if(0>n)for(;(a=e+n*++r)>t;)i.push(a);else for(;(a=e+n*++r)<t;)i.push(a);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,a=function(){return e+n*Math.random()};return a.samples=function(e){return i.zeros(e).map(a)},a.pdf=function(a){return a>=e&&t>=a?1/n:0},a.cdf=function(a){return e>a?0:a>t?1:(a-e)/n},a.icdf=function(t){return t>=0&&1>=t?e+t*n:NaN},a},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,a=function(){return e+Math.floor(n*Math.random())};return a.samples=function(e){return i.zeros(e).map(a)},a.pdf=function(a){return a===Math.floor(a)&&a>=e&&t>a?1/n:0},a.cdf=function(a){var i=Math.floor(a);return e>i?0:i>=t?1:(i-e+1)/n},a.icdf=function(t){return t>=0&&1>=t?e-1+Math.floor(t*n):NaN},a},i.random.normal=function(e,t){e=e||0,t=t||1;var n,a=function(){var a,i,r=0,o=0;if(void 0!==n)return r=n,n=void 0,r;do r=2*Math.random()-1,o=2*Math.random()-1,a=r*r+o*o;while(0===a||a>1);return i=Math.sqrt(-2*Math.log(a)/a),n=e+o*i*t,e+r*i*t};return a.samples=function(e){return i.zeros(e).map(a)},a.pdf=function(n){var a=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*a},a.cdf=function(n){var a,i=(n-e)/t,r=Math.abs(i);if(r>37)a=0;else{var o,u=Math.exp(-r*r/2);7.07106781186547>r?(o=.0352624965998911*r+.700383064443688,o=o*r+6.37396220353165,o=o*r+33.912866078383,o=o*r+112.079291497871,o=o*r+221.213596169931,o=o*r+220.206867912376,a=u*o,o=.0883883476483184*r+1.75566716318264,o=o*r+16.064177579207,o=o*r+86.7807322029461,o=o*r+296.564248779674,o=o*r+637.333633378831,o=o*r+793.826512519948,o=o*r+440.413735824752,a/=o):(o=r+.65,o=r+4/o,o=r+3/o,o=r+2/o,o=r+1/o,a=u/o/2.506628274631)}return i>0?1-a:a},a.icdf=function(n){if(0>=n||n>=1)return NaN;var a=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),r=2/(Math.PI*i)+Math.log(1-Math.pow(a,2))/2,o=Math.log(1-a*a)/i,u=(a>0?1:-1)*Math.sqrt(Math.sqrt(r*r-o)-r);return e+t*Math.SQRT2*u},a},i.random.bootstrap=function(e,t){var n=e.filter(a.isValid),r=n.length,o=t?i.random.normal(0,t):null,u=function(){return n[~~(Math.random()*r)]+(o?o():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":6}],5:[function(e,t,n){function a(e){return l.setTime(+e),l}function i(e,t,n,a,i,r){var o={type:e,date:t,unit:n};return a?o.step=a:o.minstep=1,null!=i&&(o.min=i),null!=r&&(o.max=r),o}function r(e,t,n,a,r,o){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},a,r,o)}function o(e,t,n,a){var i,r,o,u=m[0];for(i=1,r=m.length;r>i;++i)if(u=m[i],t>u[0]){if(o=t/u[0],o>a)return e[m[i-1][1]];if(o>=n)return e[u[1]]}return e[m[r-1][1]]}function u(e){var t,n,a={};for(t=0,n=e.length;n>t;++t)a[e[t].type]=e[t];return a.find=function(t,n,a){return o(e,t,n,a)},a}var c=e("d3-time"),l=new Date,s=new Date(0,0,1).setFullYear(0),f=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),d=[r("second",c.second,s),r("minute",c.minute,s),r("hour",c.hour,s),r("day",c.day,s,[1,7]),r("month",c.month,s,[1,3,6]),r("year",c.year,s),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return a(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return a(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return a(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return a(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return a(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return a(e).getMonth()},[1],0,11)],p=[r("second",c.utcSecond,f),r("minute",c.utcMinute,f),r("hour",c.utcHour,f),r("day",c.utcDay,f,[1,7]),r("month",c.utcMonth,f,[1,3,6]),r("year",c.utcYear,f),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return a(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return a(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return a(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return a(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return a(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return a(e).getUTCMonth()},[1],0,11)],m=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(d),t.exports.utc=u(p)},{"d3-time":2}],6:[function(e,t,n){(function(e){function n(e,t){var n,a="";for(n=0;e>n;++n)a+=t;return a}function a(e,t,n){var a=0,i=e.split(c);return e=n?(i=i.reverse()).filter(function(e){return a+=e.length,t>=a}).reverse():i.filter(function(e){return a+=e.length,t>=a}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,r="__name__";i.namedfunc=function(e,t){return t[r]=e,t},i.name=function(e){return null==e?null:e[r]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,n,a=1,i=arguments.length;i>a;++a){t=arguments[a];for(n in t)e[n]=t[n]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),a=1;t>a;++a)n+="|"+String(e[a]);return n};var o=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===o.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===o.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===o.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===o.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},i.isDate=function(e){return"[object Date]"===o.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},i.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,n){for(var a=0;a<t.length-1;++a)e=e[t[a]];e[t[a]]=n}:function(t,n){t[e]=n}},i.$func=function(e,t){return function(n){n=i.$(n)||i.identity;var a=e+(i.name(n)?"_"+i.name(n):"");return i.namedfunc(a,function(e){return t(n(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var n=i.isArray(t)?i.toMap(t):t;return function(t){return!!n[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),i.accessor(e)}),function(n,a){var i,r,o,u,c;for(i=0,r=e.length;r>i;++i){if(o=e[i],u=o(n),c=o(a),c>u)return-1*t[i];if(u>c)return t[i]}return 0}},i.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e?-1:null===t?1:NaN},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,n){var a=e.reduce(function(e,t,a){return e[n(t)]=a,e},{});return e.sort(function(e,i){var r=t(e),o=t(i);return o>r?-1:r>o?1:a[n(e)]-a[n(i)]}),e},i.pad=function(e,t,a,i){i=i||" ";var r=t-e.length;if(0>=r)return e;switch(a){case"left":return n(r,i)+e;case"middle":case"center":return n(Math.floor(r/2),i)+e+n(Math.ceil(r/2),i);default:return e+n(r,i)}},i.truncate=function(e,t,n,i,r){var o=e.length;if(t>=o)return e;r=void 0!==r?String(r):"â€¦";var u=Math.max(0,t-r.length);switch(n){case"left":return r+(i?a(e,u,1):e.slice(o-u));case"middle":case"center":var c=Math.ceil(u/2),l=Math.floor(u/2);return(i?a(e,c):e.slice(0,c))+r+(i?a(e,l,1):e.slice(o-l));default:return(i?a(e,u):e.slice(0,u))+r}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:1}],7:[function(e,t,n){!function(e){e[e.VALUES="values"]="VALUES",e[e.COUNT="count"]="COUNT",e[e.VALID="valid"]="VALID",e[e.MISSING="missing"]="MISSING",e[e.DISTINCT="distinct"]="DISTINCT",e[e.SUM="sum"]="SUM",e[e.MEAN="mean"]="MEAN",e[e.AVERAGE="average"]="AVERAGE",e[e.VARIANCE="variance"]="VARIANCE",e[e.VARIANCEP="variancep"]="VARIANCEP",e[e.STDEV="stdev"]="STDEV",e[e.STDEVP="stdevp"]="STDEVP",e[e.MEDIAN="median"]="MEDIAN",e[e.Q1="q1"]="Q1",e[e.Q3="q3"]="Q3",e[e.MODESKEW="modeskew"]="MODESKEW",e[e.MIN="min"]="MIN",e[e.MAX="max"]="MAX",e[e.ARGMIN="argmin"]="ARGMIN",e[e.ARGMAX="argmax"]="ARGMAX"}(n.AggregateOp||(n.AggregateOp={}));var a=n.AggregateOp;n.AGGREGATE_OPS=[a.VALUES,a.COUNT,a.VALID,a.MISSING,a.DISTINCT,a.SUM,a.MEAN,a.AVERAGE,a.VARIANCE,a.VARIANCEP,a.STDEV,a.STDEVP,a.MEDIAN,a.Q1,a.Q3,a.MODESKEW,a.MIN,a.MAX,a.ARGMIN,a.ARGMAX],n.SHARED_DOMAIN_OPS=[a.MEAN,a.AVERAGE,a.STDEV,a.STDEVP,a.MEDIAN,a.Q1,a.Q3,a.MIN,a.MAX]},{}],8:[function(e,t,n){!function(e){e[e.TOP="top"]="TOP",e[e.RIGHT="right"]="RIGHT",e[e.LEFT="left"]="LEFT",e[e.BOTTOM="bottom"]="BOTTOM"}(n.AxisOrient||(n.AxisOrient={}));n.AxisOrient;n.defaultAxisConfig={offset:void 0,grid:void 0,labels:!0,labelMaxLength:25,tickSize:void 0,characterWidth:6},n.defaultFacetAxisConfig={axisWidth:0,labels:!0,grid:!1,tickSize:0}},{}],9:[function(e,t,n){function a(e){switch(e){case i.ROW:case i.COLUMN:case i.SIZE:case i.SHAPE:return 6;default:return 10}}var i=e("./channel");n.autoMaxBins=a},{"./channel":10}],10:[function(e,t,n){function a(e,t){return!!i(e)[t]}function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.ORDER:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,circle:!0,square:!0,bar:!0,line:!0,area:!0,text:!0};case n.SIZE:return{point:!0,tick:!0,circle:!0,square:!0,bar:!0,text:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0};case n.PATH:return{line:!0}}return{}}function r(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.LABEL:return{measure:!0,dimension:!0};case n.ROW:case n.COLUMN:case n.SHAPE:case n.DETAIL:return{measure:!1,dimension:!0};case n.SIZE:case n.TEXT:return{measure:!0,dimension:!1};case n.PATH:return{measure:!1,dimension:!0}}throw new Error("Invalid encoding channel"+e)}function o(e){return!u.contains([n.DETAIL,n.PATH,n.TEXT,n.LABEL,n.ORDER],e)}var u=e("./util");!function(e){e[e.X="x"]="X",e[e.Y="y"]="Y",e[e.ROW="row"]="ROW",e[e.COLUMN="column"]="COLUMN",e[e.SHAPE="shape"]="SHAPE",e[e.SIZE="size"]="SIZE",e[e.COLOR="color"]="COLOR",e[e.TEXT="text"]="TEXT",e[e.DETAIL="detail"]="DETAIL",e[e.LABEL="label"]="LABEL",e[e.PATH="path"]="PATH",e[e.ORDER="order"]="ORDER"}(n.Channel||(n.Channel={}));var c=n.Channel;n.X=c.X,n.Y=c.Y,n.ROW=c.ROW,n.COLUMN=c.COLUMN,n.SHAPE=c.SHAPE,n.SIZE=c.SIZE,n.COLOR=c.COLOR,n.TEXT=c.TEXT,n.DETAIL=c.DETAIL,n.LABEL=c.LABEL,n.PATH=c.PATH,n.ORDER=c.ORDER,n.CHANNELS=[n.X,n.Y,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.PATH,n.ORDER,n.TEXT,n.DETAIL,n.LABEL],n.UNIT_CHANNELS=u.without(n.CHANNELS,[n.ROW,n.COLUMN]),n.UNIT_SCALE_CHANNELS=u.without(n.UNIT_CHANNELS,[n.PATH,n.ORDER,n.DETAIL,n.TEXT,n.LABEL]),n.NONSPATIAL_CHANNELS=u.without(n.UNIT_CHANNELS,[n.X,n.Y]),n.NONSPATIAL_SCALE_CHANNELS=u.without(n.UNIT_SCALE_CHANNELS,[n.X,n.Y]),n.supportMark=a,n.getSupportedMark=i,n.getSupportedRole=r,n.hasScale=o},{"./util":43}],11:[function(e,t,n){function a(e,t){return t.reduce(function(t,n){return e.axis(n)&&(t[n]=r(n,e)),t},{})}function i(e,t){var a=e===h.COLUMN,i=e===h.ROW,r=a?"x":i?"y":e,o={type:r,scale:t.scaleName(e),grid:!0,tickSize:0,properties:{labels:{text:{value:""}},axis:{stroke:{value:"transparent"}}}},u=t.axis(e);return["layer","ticks","values","subdivide"].forEach(function(a){var i,r=(i=n[a])?i(t,e,o):u[a];void 0!==r&&(o[a]=r)}),o}function r(e,t){var a=e===h.COLUMN,i=e===h.ROW,r=a?"x":i?"y":e,o=t.axis(e),u={type:r,scale:t.scaleName(e)};O.extend(u,T.formatMixins(t,e,t.axis(e).format)),["grid","layer","offset","orient","tickSize","ticks","title","tickPadding","tickSize","tickSizeMajor","tickSizeMinor","tickSizeEnd","titleOffset","values","subdivide"].forEach(function(a){var i,r=(i=n[a])?i(t,e,u):o[a];void 0!==r&&(u[a]=r)});var c=t.axis(e).properties||{};return["axis","labels","grid","title","ticks","majorTicks","minorTicks"].forEach(function(n){var a=v[n]?v[n](t,e,c[n]||{},u):c[n];void 0!==a&&O.keys(a).length>0&&(u.properties=u.properties||{},u.properties[n]=a)}),u}function o(e,t){return e.axis(t).offset}function u(e,t){var n=e.axis(t).grid;return void 0!==n?n:!e.isOrdinalScale(t)&&!e.fieldDef(t).bin}function c(e,t){return t!==h.ROW&&t!==h.COLUMN?u(e,t)&&(t===h.Y||t===h.X)&&!e.parent():void 0}function l(e,t,n){var a=e.axis(t).layer;return void 0!==a?a:n.grid?"back":void 0}function s(e,t){var n=e.axis(t).orient;return n?n:t===h.COLUMN?m.AxisOrient.TOP:void 0}function f(e,t){var n=e.axis(t).ticks;return void 0!==n?n:t!==h.X||e.fieldDef(t).bin?void 0:5}function d(e,t){var n=e.axis(t).tickSize;return void 0!==n?n:void 0}function p(e,t){var n=e.axis(t);if(void 0!==n.title)return n.title;var a,i=g.title(e.fieldDef(t));if(n.titleMaxLength)a=n.titleMaxLength;else if(t!==h.X||e.isOrdinalScale(h.X)){if(t===h.Y&&!e.isOrdinalScale(h.Y)){var r=e;a=r.cellHeight()/e.axis(h.Y).characterWidth}}else{var r=e;a=r.cellWidth()/e.axis(h.X).characterWidth}return a?O.truncate(i,a):i}var m=e("../axis"),h=e("../channel"),g=e("../fielddef"),y=e("../type"),O=e("../util"),T=e("./common");n.parseAxisComponent=a,n.parseInnerAxis=i,n.parseAxis=r,n.offset=o,n.gridShow=u,n.grid=c,n.layer=l,n.orient=s,n.ticks=f,n.tickSize=d,n.title=p;var v;!function(e){function t(e,t,n,a){var i=e.axis(t);return O.extend(void 0!==i.axisWidth?{strokeWidth:{value:i.axisWidth}}:{},n||{})}function n(e,t,n,a){var i=e.fieldDef(t),r=e.axis(t);return r.labels?(O.contains([y.NOMINAL,y.ORDINAL],i.type)&&r.labelMaxLength&&(n=O.extend({text:{template:"{{ datum.data | truncate:"+r.labelMaxLength+"}}"}},n||{})),void 0!==r.labelAngle?n.angle={value:r.labelAngle}:t!==h.X||!g.isDimension(i)&&i.type!==y.TEMPORAL||(n.angle={value:270}),void 0!==r.labelAlign?n.align={value:r.labelAlign}:n.angle&&(270===n.angle.value?n.align={value:"top"===a.orient?"left":"x"===a.type?"right":"center"}:90===n.angle.value&&(n.align={value:"center"})),void 0!==r.labelBaseline?n.baseline={value:r.labelBaseline}:n.angle&&(270===n.angle.value?n.baseline={value:"x"===a.type?"middle":"bottom"}:90===n.angle.value&&(n.baseline={value:"bottom"})),n||void 0):O.extend({text:""},n)}e.axis=t,e.labels=n}(v=n.properties||(n.properties={}))},{"../axis":8,"../channel":10,"../fielddef":34,"../type":42,"../util":43,"./common":12}],12:[function(e,t,n){function a(e,t,n){return"facet"in e?new g.FacetModel(e,t,n):new O.UnitModel(e,t,n)}function i(e,t){var a=t.config().mark.filled,i=t.fieldDef(f.COLOR);o(e,t,n.FILL_STROKE_CONFIG);var r;t.has(f.COLOR)?r={scale:t.scaleName(f.COLOR),field:t.field(f.COLOR,i.type===m.ORDINAL?{prefn:"rank_"}:{})}:i&&i.value&&(r={value:i.value}),void 0!==r?a?e.fill=r:e.stroke=r:e[a?"fill":"stroke"]=e[a?"fill":"stroke"]||{value:t.config().mark.color}}function r(e,t,n){return n.forEach(function(n){var a=t[n];void 0!==a&&(e[n]={value:a})}),e}function o(e,t,n){return r(e,t.config().mark,n)}function u(e,t,n){var a=e.fieldDef(t);if(!h.contains([m.QUANTITATIVE,m.TEMPORAL],a.type))return{};var i={};if(a.type===m.TEMPORAL&&(i.formatType="time"),void 0!==n)i.format=n;else switch(a.type){case m.QUANTITATIVE:i.format=e.config().numberFormat;break;case m.TEMPORAL:i.format=s(e,t)||e.config().timeFormat}if(t===f.TEXT){var r=(i.formatType||"number")+(i.format?":'"+i.format+"'":"");return{text:{template:"{{"+e.field(t,{datum:!0})+" | "+r+"}}"}}}return i}function c(e,t,n){switch(t){case f.ROW:case f.COLUMN:case f.X:case f.Y:return e.axis(t).shortTimeLabels;case f.COLOR:case f.SHAPE:case f.SIZE:return e.legend(t).shortTimeLabels;case f.TEXT:return e.config().mark.shortTimeLabels;case f.LABEL:}return!1}function l(e){return(e.sort===p.SortOrder.DESCENDING?"-":"")+d.field(e)}function s(e,t){var n=e.fieldDef(t);return y.format(n.timeUnit,c(e,t,n))}var f=e("../channel"),d=e("../fielddef"),p=e("../sort"),m=e("../type"),h=e("../util"),g=e("./facet"),y=e("../timeunit"),O=e("./unit");n.buildModel=a,n.FILL_STROKE_CONFIG=["fill","fillOpacity","stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","opacity"],n.applyColorAndOpacity=i,n.applyConfig=r,n.applyMarkConfig=o,n.formatMixins=u,n.sortField=l,n.timeFormat=s},{"../channel":10,"../fielddef":34,"../sort":39,"../timeunit":41,"../type":42,"../util":43,"./facet":16,"./unit":30}],13:[function(e,t,n){function a(e){var t=u.normalize(e),n=l.buildModel(t,null,"");return n.parse(),i(n)}function i(e){var t=e.config(),n=c.extend({width:1,height:1,padding:"auto"},t.viewport?{viewport:t.viewport}:{},t.background?{background:t.background}:{},{data:[].concat(e.assembleData([]),e.assembleLayout([])),marks:[r(e)]});return{spec:n}}function r(e){var t=c.extend({name:e.name("root"),type:"group"},e.description()?{description:e.description()}:{},{from:{data:o.LAYOUT},properties:{update:c.extend({width:{field:"width"},height:{field:"height"}},e.assembleParentGroupProperties(e.config().cell))}});return c.extend(t,e.assembleGroup())}var o=e("../data"),u=e("../spec"),c=e("../util"),l=e("./common");n.compile=a,n.assembleRootGroup=r},{"../data":32,"../spec":40,"../util":43,"./common":12}],14:[function(e,t,n){function a(e,t,n){return c.extend(["filled","opacity","orient","align"].reduce(function(a,l){var s=n.mark[l];switch(l){case"filled":void 0===s&&(a[l]=e!==u.POINT&&e!==u.LINE);break;case"opacity":void 0===s&&c.contains([u.POINT,u.TICK,u.CIRCLE,u.SQUARE],e)&&(r.isAggregate(t)&&!r.has(t,i.DETAIL)||(a[l]=.7));break;case"orient":var f=o.isMeasure(t.x),d=o.isMeasure(t.y);f&&!d?a[l]="horizontal":!f&&d&&(a[l]=void 0);break;case"align":void 0===s&&(a[l]=r.has(t,i.X)?"center":"right")}return a},{}),n.mark)}var i=e("../channel"),r=e("../encoding"),o=e("../fielddef"),u=e("../mark"),c=e("../util");n.initMarkConfig=a},{"../channel":10,"../encoding":33,"../fielddef":34,"../mark":36,"../util":43}],15:[function(e,t,n){function a(e){return{source:g.parseUnit(e),formatParse:y.parseUnit(e),nullFilter:v.parseUnit(e),filter:E.parseUnit(e),bin:T.parseUnit(e),calculate:S.parseUnit(e),timeUnit:O.parseUnit(e),timeUnitDomain:M.parseUnit(e),summary:A.parseUnit(e),stackScale:N.parseUnit(e),colorRank:R.parseUnit(e),nonPositiveFilter:L.parseUnit(e)}}function i(e){return{source:g.parseFacet(e),formatParse:y.parseFacet(e),nullFilter:v.parseFacet(e),filter:E.parseFacet(e),bin:T.parseFacet(e),calculate:S.parseFacet(e),timeUnit:O.parseFacet(e),timeUnitDomain:M.parseFacet(e),summary:A.parseFacet(e),stackScale:N.parseFacet(e),colorRank:R.parseFacet(e),nonPositiveFilter:L.parseFacet(e)}}function r(e,t){var n=e.component.data,a=g.assemble(n);if(a&&t.push(a),A.assemble(n).forEach(function(e){t.push(e)}),t.length>0){var i=t[t.length-1],r=R.assemble(n);r.length>0&&(i.transform=(i.transform||[]).concat(r));var o=L.assemble(n);o.length>0&&(i.transform=(i.transform||[]).concat(o))}else{if(p.keys(n.colorRank).length>0)throw new Error("Invalid colorRank not merged");if(p.keys(n.nonPositiveFilter).length>0)throw new Error("Invalid nonPositiveFilter not merged")}var u=N.assemble(n);return u&&t.push(u),M.assemble(n).forEach(function(e){t.push(e)}),t}var o=e("../aggregate"),u=e("../bin"),c=e("../channel"),l=e("../data"),s=e("../fielddef"),f=e("../scale"),d=e("../type"),p=e("../util"),m=e("./time"),h={nominal:!1,ordinal:!1,quantitative:!0,temporal:!0};n.parseUnitData=a,n.parseFacetData=i,n.assembleData=r;var g;!function(e){function t(e){var t=e.data();if(t){var n={name:e.dataName(l.SOURCE)};if(t.values&&t.values.length>0)n.values=e.data().values,n.format={type:"json"};else if(t.url){n.url=t.url;var a=/(?:\.([^.]+))?$/.exec(n.url)[1];p.contains(["json","csv","tsv"],a)||(a="json"),n.format={type:e.data().formatType||a}}return n}return e.parent()?void 0:{name:e.dataName(l.SOURCE)}}function n(e){var n=t(e);return e.child().component.data.source||e.child().renameData(e.child().dataName(l.SOURCE),e.dataName(l.SOURCE)),n}function a(e){if(e.source){var t=e.source;return e.formatParse&&(e.source.format=e.source.format||{},e.source.format.parse=e.formatParse),t.transform=[].concat(v.assemble(e),S.assemble(e),E.assemble(e),T.assemble(e),O.assemble(e)),t}return null}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(g=n.source||(n.source={}));var y;!function(e){function t(e){var t,n=(e.transform().calculate||[]).reduce(function(e,t){return e[t.field]=!0,e},{});return e.forEach(function(e){if(e.type===d.TEMPORAL)t=t||{},t[e.field]="date";else if(e.type===d.QUANTITATIVE){if(s.isCount(e)||n[e.field])return;t=t||{},t[e.field]="number"}}),t}function n(e){var n=t(e),a=e.child().component.data;return!a.source&&a.formatParse&&(n=p.extend(n||{},a.formatParse),delete a.formatParse),n}e.parseUnit=t,e.parseFacet=n}(y=n.formatParse||(n.formatParse={}));var O;!function(e){function t(e){return e.reduce(function(e,t,n){var a=s.field(t,{nofn:!0,datum:!0});if(t.type===d.TEMPORAL&&t.timeUnit){var i=s.field(t);e[i]={type:"formula",field:s.field(t),expr:m.parseExpression(t.timeUnit,a)}}return e},{})}function n(e){var n=t(e),a=e.child().component.data;return a.source||(p.extend(n,a.timeUnit),delete a.timeUnit),n}function a(e){return p.vals(e.timeUnit)}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(O=n.timeUnit||(n.timeUnit={}));var T;!function(e){function t(e){return e.reduce(function(t,n,a){var i=e.fieldDef(a).bin;if(i){var r=p.extend({type:"bin",field:n.field,output:{start:s.field(n,{binSuffix:"_start"}),mid:s.field(n,{binSuffix:"_mid"}),end:s.field(n,{binSuffix:"_end"})}},"boolean"==typeof i?{}:i);r.maxbins||r.step||(r.maxbins=u.autoMaxBins(a));var o=[r],l=e.isOrdinalScale(a)||a===c.COLOR;l&&o.push({type:"formula",field:s.field(n,{binSuffix:"_range"}),expr:s.field(n,{datum:!0,binSuffix:"_start"})+" + '-' + "+s.field(n,{datum:!0,binSuffix:"_end"})});var f=JSON.stringify(i)+"_"+n.field+"oc:"+l;t[f]=o}return t},{})}function n(e){var n=t(e),a=e.child().component.data;return a.source||(p.extend(n,a.bin),delete a.bin),n}function a(e){return p.flatten(p.vals(e.bin))}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(T=n.bin||(n.bin={}));var v;!function(e){function t(e){var t=e.transform().filterNull;return e.reduce(function(e,n){return(t||void 0===t&&n.field&&"*"!==n.field&&h[n.type])&&(e[n.field]=!0),e},{})}function n(e){var n=t(e),a=e.child().component.data;return a.source||(p.extend(n,a.nullFilter),delete a.nullFilter),n}function a(e){var t=p.keys(e.nullFilter);return t.length>0?[{type:"filter",test:t.map(function(e){return"datum."+e+"!==null"}).join(" && ")}]:[]}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(v=n.nullFilter||(n.nullFilter={}));var E;!function(e){function t(e){return e.transform().filter}function n(e){var n=t(e),a=e.child().component.data;return!a.source&&a.filter&&(n=(n?n+" && ":"")+a.filter,delete a.filter),n}function a(e){var t=e.filter;return t?[{type:"filter",test:t}]:[]}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(E=n.filter||(n.filter={}));var S;!function(e){function t(e){return(e.transform().calculate||[]).reduce(function(e,t){return e[JSON.stringify(t)]=t,e},{})}function n(e){var n=t(e),a=e.child().component.data;return a.source||(p.extend(n,a.calculate),delete a.calculate),n}function a(e){return p.vals(e.calculate).reduce(function(e,t){return e.push(p.extend({type:"formula"},t)),e},[])}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(S=n.formula||(n.formula={}));var A;
!function(e){function t(e,t){return t.bin?(e[s.field(t,{binSuffix:"_start"})]=!0,e[s.field(t,{binSuffix:"_mid"})]=!0,e[s.field(t,{binSuffix:"_end"})]=!0,e[s.field(t,{binSuffix:"_range"})]=!0):e[s.field(t)]=!0,e}function n(e){var n={},a={};return e.forEach(function(e,i){e.aggregate?e.aggregate===o.AggregateOp.COUNT?(a["*"]=a["*"]||{},a["*"].count=!0):(a[e.field]=a[e.field]||{},a[e.field][e.aggregate]=!0):t(n,e)}),[{name:e.dataName(l.SUMMARY),source:e.dataName(l.SOURCE),dimensions:n,measures:a}]}function a(e){var n=e.child().component.data;if(!n.source&&n.summary){var a=n.summary.map(function(n){return n.name=e.dataName(l.SUMMARY),n.source=e.dataName(l.SOURCE),n.dimensions=e.reduce(t,n.dimensions),n});return e.child().renameData(e.child().dataName(l.SUMMARY),e.dataName(l.SUMMARY)),delete n.summary,a}return[]}function i(e){return e.summary?e.summary.reduce(function(e,t){var n=t.dimensions,a=t.measures,i=p.keys(n),r=p.reduce(a,function(e,t,n){return e[n]=p.keys(t),e},{});return p.keys(a).length>0&&e.push({name:t.name,source:t.source,transform:[{type:"aggregate",groupby:i,summarize:r}]}),e},[]):[]}e.parseUnit=n,e.parseFacet=a,e.assemble=i}(A=n.summary||(n.summary={}));var N;!function(e){function t(e){var t=e.stack();if(t){var n=t.groupbyChannel,a=t.fieldChannel;return{name:e.dataName(l.STACKED_SCALE),source:e.dataName(l.SUMMARY),transform:[{type:"aggregate",groupby:[e.field(n)],summarize:[{ops:["sum"],field:e.field(a)}]}]}}return null}function n(e){var t=e.child(),n=t.component.data;if(!n.source&&n.stackScale){var a=n.stackScale,i=e.dataName(l.STACKED_SCALE);return t.renameData(a.name,i),a.name=i,a.source=e.dataName(l.SUMMARY),a.transform[0].groupby=e.reduce(function(e,t){return e.push(s.field(t)),e},a.transform[0].groupby),delete n.stackScale,a}return null}function a(e){return e.stackScale}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(N=n.stackScale||(n.stackScale={}));var M;!function(e){function t(e){return e.reduce(function(e,t,n){if(t.timeUnit){var a=m.rawDomain(t.timeUnit,n);a&&(e[t.timeUnit]=!0)}return e},{})}function n(e){return p.extend(t(e),e.child().component.data.timeUnitDomain)}function a(e){return p.keys(e.timeUnitDomain).reduce(function(e,t){var n=t,a=m.rawDomain(n,null);return a&&e.push({name:n,values:a,transform:[{type:"formula",field:"date",expr:m.parseExpression(n,"datum.data",!0)}]}),e},[])}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(M=n.timeUnitDomain||(n.timeUnitDomain={}));var R;!function(e){function t(e){var t={};return e.has(c.COLOR)&&e.fieldDef(c.COLOR).type===d.ORDINAL&&(t[e.field(c.COLOR)]=[{type:"sort",by:e.field(c.COLOR)},{type:"rank",field:e.field(c.COLOR),output:{rank:e.field(c.COLOR,{prefn:"rank_"})}}]),t}function n(e){var t=e.child().component.data;if(!t.source){var n=t.colorRank;return delete t.colorRank,n}return{}}function a(e){return p.flatten(p.vals(e.colorRank))}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(R=n.colorRank||(n.colorRank={}));var L;!function(e){function t(e){return e.channels().reduce(function(t,n){var a=e.scale(n);return a&&a.type===f.ScaleType.LOG&&(t[e.field(n)]=!0),t},{})}function n(e){var t=e.child().component.data;if(!t.source){var n=t.nonPositiveFilter;return delete t.nonPositiveFilter,n}return{}}function a(e){return p.keys(e.nonPositiveFilter).map(function(e){return{type:"filter",test:"datum."+e+" > 0"}})}e.parseUnit=t,e.parseFacet=n,e.assemble=a}(L=n.nonPositiveFilter||(n.nonPositiveFilter={}))},{"../aggregate":7,"../bin":9,"../channel":10,"../data":32,"../fielddef":34,"../scale":37,"../type":42,"../util":43,"./time":29}],16:[function(e,t,n){function a(e){var t=e.child(),n=O.extend({},t.config().cell,t.config().facet.cell);return O.extend({x:e.has(f.COLUMN)?{scale:e.scaleName(f.COLUMN),field:e.field(f.COLUMN),offset:e.scale(f.COLUMN).padding/2}:{value:e.config().facet.scale.padding/2},y:e.has(f.ROW)?{scale:e.scaleName(f.ROW),field:e.field(f.ROW),offset:e.scale(f.ROW).padding/2}:{value:e.config().facet.scale.padding/2},width:{field:{parent:e.child().sizeName("width")}},height:{field:{parent:e.child().sizeName("height")}}},t.assembleParentGroupProperties(n))}function i(e,t){var n=null,a=e.child();return a.has(t)&&a.axis(t)&&(n=t===f.X?r(e):o(e),a.axis(t)&&T.gridShow(a,t)?a.component.axis[t]=T.parseInnerAxis(t,a):delete a.component.axis[t]),n}function r(e){var t=e.has(f.COLUMN);return O.extend({name:e.name("x-axes"),type:"group"},t?{from:{data:e.dataTable(),transform:[{type:"aggregate",groupby:[e.field(f.COLUMN)],summarize:{"*":["count"]}}]}}:{},{properties:{update:{width:{field:{parent:e.child().sizeName("width")}},height:{field:{group:"height"}},x:t?{scale:e.scaleName(f.COLUMN),field:e.field(f.COLUMN),offset:e.scale(f.COLUMN).padding/2}:{value:e.config().facet.scale.padding/2}}},axes:[T.parseAxis(f.X,e.child())]})}function o(e){var t=e.has(f.ROW);return O.extend({name:e.name("y-axes"),type:"group"},t?{from:{data:e.dataTable(),transform:[{type:"aggregate",groupby:[e.field(f.ROW)],summarize:{"*":["count"]}}]}}:{},{properties:{update:{width:{field:{group:"width"}},height:{field:{parent:e.child().sizeName("height")}},y:t?{scale:e.scaleName(f.ROW),field:e.field(f.ROW),offset:e.scale(f.ROW).padding/2}:{value:e.config().facet.scale.padding/2}}},axes:[T.parseAxis(f.Y,e.child())]})}function u(e){var t=e.config().facet.grid,n={name:e.name("row-grid"),type:"rule",from:{data:e.dataTable(),transform:[{type:"facet",groupby:[e.field(f.ROW)]}]},properties:{update:{y:{scale:e.scaleName(f.ROW),field:e.field(f.ROW)},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}};return[n,{name:e.name("row-grid-end"),type:"rule",properties:{update:{y:{field:{group:"height"}},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}function c(e){var t=e.config().facet.grid,n={name:e.name("column-grid"),type:"rule",from:{data:e.dataTable(),transform:[{type:"facet",groupby:[e.field(f.COLUMN)]}]},properties:{update:{x:{scale:e.scaleName(f.COLUMN),field:e.field(f.COLUMN)},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}};return[n,{name:e.name("column-grid-end"),type:"rule",properties:{update:{x:{field:{group:"width"}},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}var l=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=e("../axis"),f=e("../channel"),d=e("../config"),p=e("../data"),m=e("../encoding"),h=e("../fielddef"),g=e("../scale"),y=e("../type"),O=e("../util"),T=e("./axis"),v=e("./common"),E=e("./data"),S=e("./layout"),A=e("./model"),N=e("./scale"),M=function(e){function t(t,n,a){e.call(this,t,n,a);var i=this._config=this._initConfig(t.config,n),r=this._child=v.buildModel(t.spec,this,this.name("child")),o=this._facet=this._initFacet(t.facet);this._scale=this._initScale(o,i,r),this._axis=this._initAxis(o,i,r)}return l(t,e),t.prototype._initConfig=function(e,t){return O.mergeDeep(O.duplicate(d.defaultConfig),e,t?t.config():{})},t.prototype._initFacet=function(e){e=O.duplicate(e);var t=this;return m.channelMappingForEach(this.channels(),e,function(e,n){h.isDimension(e)||t.addWarning(n+" encoding should be ordinal."),e.type&&(e.type=y.getFullName(e.type))}),e},t.prototype._initScale=function(e,t,n){return[f.ROW,f.COLUMN].reduce(function(a,i){if(e[i]){var r=e[i].scale||{};a[i]=O.extend({type:g.ScaleType.ORDINAL,round:t.facet.scale.round,padding:i===f.ROW&&n.has(f.Y)||i===f.COLUMN&&n.has(f.X)?t.facet.scale.padding:0},r)}return a},{})},t.prototype._initAxis=function(e,t,n){return[f.ROW,f.COLUMN].reduce(function(a,i){if(e[i]){var r=e[i].axis;if(r!==!1){var o=a[i]=O.extend({},t.facet.axis,r===!0?{}:r||{});if(i===f.ROW){var u=n.axis(f.Y);u&&u.orient!==s.AxisOrient.RIGHT&&!o.orient&&(o.orient=s.AxisOrient.RIGHT),n.has(f.X)&&!o.labelAngle&&(o.labelAngle=o.orient===s.AxisOrient.RIGHT?90:270)}}}return a},{})},t.prototype.facet=function(){return this._facet},t.prototype.has=function(e){return!!this._facet[e]},t.prototype.child=function(){return this._child},t.prototype.hasSummary=function(){for(var e=this.component.data.summary,t=0;t<e.length;t++)if(O.keys(e[t].measures).length>0)return!0;return!1},t.prototype.dataTable=function(){return(this.hasSummary()?p.SUMMARY:p.SOURCE)+""},t.prototype.fieldDef=function(e){return this.facet()[e]},t.prototype.stack=function(){return null},t.prototype.parseData=function(){this.child().parseData(),this.component.data=E.parseFacetData(this)},t.prototype.parseSelectionData=function(){},t.prototype.parseLayoutData=function(){this.child().parseLayoutData(),this.component.layout=S.parseFacetLayout(this)},t.prototype.parseScale=function(){var e=this.child(),t=this;e.parseScale();var n=this.component.scale=N.parseScaleComponent(this);O.keys(e.component.scale).forEach(function(a){n[a]=e.component.scale[a],n[a].forEach(function(n){var a=n.name.substr(e.name("").length),i=t.scaleName(a);e.renameScale(n.name,i),n.name=i}),delete e.component.scale[a]})},t.prototype.parseMark=function(){this.child().parseMark(),this.component.mark=O.extend({name:this.name("cell"),type:"group",from:O.extend(this.dataTable()?{data:this.dataTable()}:{},{transform:[{type:"facet",groupby:[].concat(this.has(f.ROW)?[this.field(f.ROW)]:[],this.has(f.COLUMN)?[this.field(f.COLUMN)]:[])}]}),properties:{update:a(this)}},this.child().assembleGroup())},t.prototype.parseAxis=function(){this.child().parseAxis(),this.component.axis=T.parseAxisComponent(this,[f.ROW,f.COLUMN])},t.prototype.parseAxisGroup=function(){var e=i(this,f.X),t=i(this,f.Y);this.component.axisGroup=O.extend(e?{x:e}:{},t?{y:t}:{})},t.prototype.parseGridGroup=function(){var e=this.child();this.component.gridGroup=O.extend(!e.has(f.X)&&this.has(f.COLUMN)?{column:c(this)}:{},!e.has(f.Y)&&this.has(f.ROW)?{row:u(this)}:{})},t.prototype.parseLegend=function(){this.child().parseLegend(),this.component.legend=this._child.component.legend,this._child.component.legend={}},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleData=function(e){return E.assembleData(this,e),this._child.assembleData(e)},t.prototype.assembleLayout=function(e){return this._child.assembleLayout(e),S.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return[].concat(O.vals(this.component.axisGroup),O.flatten(O.vals(this.component.gridGroup)),this.component.mark)},t.prototype.channels=function(){return[f.ROW,f.COLUMN]},t.prototype.mapping=function(){return this.facet()},t}(A.Model);n.FacetModel=M},{"../axis":8,"../channel":10,"../config":31,"../data":32,"../encoding":33,"../fielddef":34,"../scale":37,"../type":42,"../util":43,"./axis":11,"./common":12,"./data":15,"./layout":17,"./model":26,"./scale":27}],17:[function(e,t,n){function a(e,t){var n=e.component.layout;if(!n.width&&!n.height)return t;var a=h.keys(h.extend(n.width.distinct,n.height.distinct)),i=n.width.formula.concat(n.height.formula).map(function(e){return h.extend({type:"formula"},e)});return[a.length>0?{name:e.dataName(p.LAYOUT),source:e.dataTable(),transform:[{type:"aggregate",summarize:a.map(function(e){return{field:e,ops:["distinct"]}})}].concat(i)}:{name:e.dataName(p.LAYOUT),values:[{}],transform:i}]}function i(e){return{width:r(e,d.X),height:r(e,d.Y)}}function r(e,t){var n=t===d.X?e.cellWidth():e.cellHeight();return{distinct:s(e,t),formula:[{field:e.channelSizeName(t),expr:o(e,t,n)}]}}function o(e,t,n){if(e.has(t)){if(e.isOrdinalScale(t)){var a=e.scale(t);return"("+f(e,t)+" + "+a.padding+") * "+a.bandSize}return n+""}return e.mark()===g.TEXT&&t===d.X?e.config().scale.textBandWidth+"":e.config().scale.bandSize+""}function u(e){return{width:c(e,d.COLUMN),height:c(e,d.ROW)}}function c(e,t){var n=e.child().component.layout,a=t===d.ROW?"height":"width",i=n[a],r=h.extend(s(e,t),i.distinct),o=i.formula.concat([{field:e.channelSizeName(t),expr:l(e,t,e.child().channelSizeName(t))}]);return delete n[a],{distinct:r,formula:o}}function l(e,t,n){var a=e.scale(t);return e.has(t)?"(datum."+n+" + "+a.padding+") * "+f(e,t):"datum."+n+" + "+e.config().facet.scale.padding}function s(e,t){if(e.has(t)&&e.isOrdinalScale(t)){var n=e.scale(t);if(n.type===m.ScaleType.ORDINAL&&!(n.domain instanceof Array)){var a=e.field(t),i={};return i[a]=!0,i}}return{}}function f(e,t){var n=e.scale(t);if(n.domain instanceof Array)return n.domain.length;var a=e.fieldDef(t).timeUnit,i=a?y.rawDomain(a,t):null;return null!==i?i.length:e.field(t,{datum:!0,prefn:"distinct_"})}var d=e("../channel"),p=e("../data"),m=e("../scale"),h=e("../util"),g=e("../mark"),y=e("./time");n.assembleLayout=a,n.parseUnitLayout=i,n.parseFacetLayout=u},{"../channel":10,"../data":32,"../mark":36,"../scale":37,"../util":43,"./time":29}],18:[function(e,t,n){function a(e){return[l.COLOR,l.SIZE,l.SHAPE].reduce(function(t,n){return e.legend(n)&&(t[n]=r(e,n)),t},{})}function i(e,t){switch(t){case l.COLOR:var n=e.fieldDef(l.COLOR),a=e.scaleName(c(n)?h.COLOR_LEGEND:l.COLOR);return e.config().mark.filled?{fill:a}:{stroke:a};case l.SIZE:return{size:e.scaleName(l.SIZE)};case l.SHAPE:return{shape:e.scaleName(l.SHAPE)}}return null}function r(e,t){var n=e.fieldDef(t),a=e.legend(t),r=i(e,t);r.title=o(a,n),p.extend(r,u(a,e,t)),["orient","values"].forEach(function(e){var t=a[e];void 0!==t&&(r[e]=t)});var c="boolean"!=typeof a&&a.properties||{};return["title","symbols","legend","labels"].forEach(function(a){var i=g[a]?g[a](n,c[a],e,t):c[a];void 0!==i&&p.keys(i).length>0&&(r.properties=r.properties||{},r.properties[a]=i)}),r}function o(e,t){return"boolean"!=typeof e&&e.title?e.title:s.title(t)}function u(e,t,n){var a=t.fieldDef(n);return a.bin?{}:m.formatMixins(t,n,"boolean"!=typeof e?e.format:void 0)}function c(e){return e.type===d.ORDINAL||e.bin||e.timeUnit}var l=e("../channel"),s=e("../fielddef"),f=e("../mark"),d=e("../type"),p=e("../util"),m=e("./common"),h=e("./scale");n.parseLegendComponent=a,n.parseLegend=r,n.title=o,n.formatMixins=u,n.useColorLegendScale=c;var g;!function(e){function t(e,t,n,a){var i={},r=n.mark();switch(r){case f.BAR:case f.TICK:case f.TEXT:i.shape={value:"square"};break;case f.CIRCLE:case f.SQUARE:i.shape={value:r};break;case f.POINT:case f.LINE:case f.AREA:}var o=n.config().mark.filled;m.applyMarkConfig(i,n,a===l.COLOR?p.without(m.FILL_STROKE_CONFIG,[o?"fill":"stroke"]):m.FILL_STROKE_CONFIG),o&&(i.strokeWidth={value:0});var u;return n.has(l.COLOR)&&a===l.COLOR?c(e)&&(u={scale:n.scaleName(l.COLOR),field:"data"}):n.fieldDef(l.COLOR).value&&(u={value:n.fieldDef(l.COLOR).value}),void 0!==u?o?i.fill=u:i.stroke=u:a!==l.COLOR&&(i[o?"fill":"stroke"]=i[o?"fill":"stroke"]||{value:n.config().mark.color}),i=p.extend(i,t||{}),p.keys(i).length>0?i:void 0}function n(e,t,n,a){if(a===l.COLOR){if(e.type===d.ORDINAL)return{text:{scale:n.scaleName(h.COLOR_LEGEND),field:"data"}};if(e.bin)return{text:{scale:n.scaleName(h.COLOR_LEGEND_LABEL),field:"data"}};if(e.timeUnit)return{text:{template:"{{ datum.data | time:'"+m.timeFormat(n,a)+"'}}"}}}}e.symbols=t,e.labels=n}(g||(g={}))},{"../channel":10,"../fielddef":34,"../mark":36,"../type":42,"../util":43,"./common":12,"./scale":27}],19:[function(e,t,n){var a,i=e("../../channel"),r=e("../../fielddef"),o=e("../common");!function(e){function t(){return"area"}function n(e){var t={},n=e.config().mark.orient;void 0!==n&&(t.orient={value:n});var a=e.stack(),u=e.encoding().x;a&&i.X===a.fieldChannel?t.x={scale:e.scaleName(i.X),field:e.field(i.X,{suffix:"_start"})}:r.isMeasure(u)?t.x={scale:e.scaleName(i.X),field:e.field(i.X)}:r.isDimension(u)&&(t.x={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_mid"})}),"horizontal"===n&&(a&&i.X===a.fieldChannel?t.x2={scale:e.scaleName(i.X),field:e.field(i.X,{suffix:"_end"})}:t.x2={scale:e.scaleName(i.X),value:0});var c=e.encoding().y;return a&&i.Y===a.fieldChannel?t.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{suffix:"_start"})}:r.isMeasure(c)?t.y={scale:e.scaleName(i.Y),field:e.field(i.Y)}:r.isDimension(c)&&(t.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_mid"})}),"horizontal"!==n&&(a&&i.Y===a.fieldChannel?t.y2={scale:e.scaleName(i.Y),field:e.field(i.Y,{suffix:"_end"})}:t.y2={scale:e.scaleName(i.Y),value:0}),o.applyColorAndOpacity(t,e),o.applyMarkConfig(t,e,["interpolate","tension"]),t}function a(e){}e.markType=t,e.properties=n,e.labels=a}(a=n.area||(n.area={}))},{"../../channel":10,"../../fielddef":34,"../common":12}],20:[function(e,t,n){var a,i=e("../../channel"),r=e("../../fielddef"),o=e("../common");!function(e){function t(){return"rect"}function n(e){var t={},n=e.config().mark.orient,u=e.stack(),c=e.encoding().x;u&&i.X===u.fieldChannel?(t.x={scale:e.scaleName(i.X),field:e.field(i.X,{suffix:"_start"})},t.x2={scale:e.scaleName(i.X),field:e.field(i.X,{suffix:"_end"})}):r.isMeasure(c)?"horizontal"===n?(t.x={scale:e.scaleName(i.X),field:e.field(i.X)},t.x2={scale:e.scaleName(i.X),value:0}):(t.xc={scale:e.scaleName(i.X),field:e.field(i.X)},t.width={value:a(e,i.X)}):e.fieldDef(i.X).bin?e.has(i.SIZE)&&"horizontal"!==n?(t.xc={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_mid"})},t.width={scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}):(t.x={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_start"}),offset:1},t.x2={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_end"})}):(e.has(i.X)?t.xc={scale:e.scaleName(i.X),field:e.field(i.X)}:t.x={value:0,offset:2},t.width=e.has(i.SIZE)&&"horizontal"!==n?{scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}:{value:a(e,i.X)});var l=e.encoding().y;return u&&i.Y===u.fieldChannel?(t.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{suffix:"_start"})},t.y2={scale:e.scaleName(i.Y),field:e.field(i.Y,{suffix:"_end"})}):r.isMeasure(l)?"horizontal"!==n?(t.y={scale:e.scaleName(i.Y),field:e.field(i.Y)},t.y2={scale:e.scaleName(i.Y),value:0}):(t.yc={scale:e.scaleName(i.Y),field:e.field(i.Y)},t.height={value:a(e,i.Y)}):e.fieldDef(i.Y).bin?e.has(i.SIZE)&&"horizontal"===n?(t.yc={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_mid"})},t.height={scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}):(t.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_start"})},t.y2={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_end"}),offset:1}):(e.has(i.Y)?t.yc={scale:e.scaleName(i.Y),field:e.field(i.Y)}:t.y2={field:{group:"height"},offset:-1},t.height=e.has(i.SIZE)&&"horizontal"===n?{scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}:{value:a(e,i.Y)}),o.applyColorAndOpacity(t,e),t}function a(e,t){var n=e.fieldDef(i.SIZE);if(n&&void 0!==n.value)return n.value;var a=e.config().mark;return a.barSize?a.barSize:e.isOrdinalScale(t)?e.scale(t).bandSize-1:e.has(t)?a.barThinSize:e.config().scale.bandSize-1}function u(e){}e.markType=t,e.properties=n,e.labels=u}(a=n.bar||(n.bar={}))},{"../../channel":10,"../../fielddef":34,"../common":12}],21:[function(e,t,n){var a,i=e("../../channel"),r=e("../common");!function(e){function t(){return"line"}function n(e){var t={};return e.has(i.X)?t.x={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_mid"})}:t.x={value:0},e.has(i.Y)?t.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_mid"})}:t.y={field:{group:"height"}},r.applyColorAndOpacity(t,e),r.applyMarkConfig(t,e,["interpolate","tension"]),t}function a(e){}e.markType=t,e.properties=n,e.labels=a}(a=n.line||(n.line={}))},{"../../channel":10,"../common":12}],22:[function(e,t,n){function a(e){return d.contains([s.LINE,s.AREA],e.mark())?i(e):r(e)}function i(e){var t=e.mark(),n=!!e.parent(),a={data:e.dataTable()},i=c(e),r=[{name:e.name("marks"),type:v[t].markType(),from:d.extend(n||i.length>0?{}:a,{transform:[{type:"sort",by:u(e)}]}),properties:{update:v[t].properties(e)}}];if(i.length>0){var p={type:"facet",groupby:i},m=t===s.AREA&&e.stack()?[f.imputeTransform(e),f.stackTransform(e),p]:[].concat(p,e.has(l.ORDER)?[{type:"sort",by:o(e)}]:[]);return[{name:e.name("-path-group"),type:"group",from:d.extend(n?{}:a,{transform:m}),properties:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]}return r}function r(e){var t=e.mark(),n=!!e.parent(),a={data:e.dataTable()},i=[];if(t===s.TEXT&&e.has(l.COLOR)&&e.config().mark.applyColorToBackground&&!e.has(l.X)&&!e.has(l.Y)&&i.push(d.extend({name:e.name("background"),type:"rect"},n?{}:{from:a},{properties:{update:y.text.background(e)}})),i.push(d.extend({name:e.name("marks"),type:v[t].markType()},!n||e.stack()||e.has(l.ORDER)?{from:d.extend(n?{}:a,e.stack()?{transform:[f.stackTransform(e)]}:e.has(l.ORDER)?{transform:[{type:"sort",by:o(e)}]}:{})}:{},{properties:{update:v[t].properties(e)}})),e.has(l.LABEL)&&v[t].labels){var r=v[t].labels(e);void 0!==r&&i.push(d.extend({name:e.name("label"),type:"text"},n?{}:{from:a},{properties:{update:r}}))}return i}function o(e){if(e.has(l.ORDER)){var t=e.encoding().order;return t instanceof Array?t.map(T.sortField):T.sortField(t)}return null}function u(e){if(e.mark()===s.LINE&&e.has(l.PATH)){var t=e.encoding().path;return t instanceof Array?t.map(T.sortField):T.sortField(t)}return"-"+e.field("horizontal"===e.config().mark.orient?l.Y:l.X)}function c(e){return[l.COLOR,l.DETAIL,l.SHAPE].reduce(function(t,n){return e.has(n)&&!e.fieldDef(n).aggregate&&t.push(e.field(n)),t},[])}var l=e("../../channel"),s=e("../../mark"),f=e("../stack"),d=e("../../util"),p=e("./area"),m=e("./bar"),h=e("./line"),g=e("./point"),y=e("./text"),O=e("./tick"),T=e("../common"),v={area:p.area,bar:m.bar,line:h.line,point:g.point,text:y.text,tick:O.tick,circle:g.circle,square:g.square};n.parseMark=a},{"../../channel":10,"../../mark":36,"../../util":43,"../common":12,"../stack":28,"./area":19,"./bar":20,"./line":21,"./point":23,"./text":24,"./tick":25}],23:[function(e,t,n){var a,i=e("../../channel"),r=e("../common");!function(e){function t(){return"symbol"}function n(e,t){var n={};return e.has(i.X)?n.x={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_mid"})}:n.x={value:e.config().scale.bandSize/2},e.has(i.Y)?n.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_mid"})}:n.y={value:e.config().scale.bandSize/2},e.has(i.SIZE)?n.size={scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}:n.size={value:a(e)},t?n.shape={value:t}:e.has(i.SHAPE)?n.shape={scale:e.scaleName(i.SHAPE),field:e.field(i.SHAPE)}:e.fieldDef(i.SHAPE).value?n.shape={value:e.fieldDef(i.SHAPE).value}:e.config().mark.shape&&(n.shape={value:e.config().mark.shape}),r.applyColorAndOpacity(n,e),n}function a(e){var t=e.fieldDef(i.SIZE);return t&&void 0!==t.value?t.value:e.config().mark.size}function o(e){}e.markType=t,e.properties=n,e.labels=o}(a=n.point||(n.point={}));var o;!function(e){function t(){return"symbol"}function n(e){return a.properties(e,"circle")}function i(e){}e.markType=t,e.properties=n,e.labels=i}(o=n.circle||(n.circle={}));var u;!function(e){function t(){return"symbol"}function n(e){return a.properties(e,"square")}function i(e){}e.markType=t,e.properties=n,e.labels=i}(u=n.square||(n.square={}))},{"../../channel":10,"../common":12}],24:[function(e,t,n){var a,i=e("../../channel"),r=e("../common"),o=e("../../util"),u=e("../../type");!function(e){function t(){return"text"}function n(e){return{x:{value:0},y:{value:0},width:{field:{group:"width"}},height:{field:{group:"height"}},fill:{scale:e.scaleName(i.COLOR),field:e.field(i.COLOR,e.fieldDef(i.COLOR).type===u.ORDINAL?{prefn:"rank_"}:{})}}}function a(e){var t={};r.applyMarkConfig(t,e,["angle","align","baseline","dx","dy","font","fontWeight","fontStyle","radius","theta","text"]);var n=e.fieldDef(i.TEXT);if(e.has(i.X)?t.x={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_mid"})}:e.has(i.TEXT)&&e.fieldDef(i.TEXT).type===u.QUANTITATIVE?t.x={field:{group:"width"},offset:-5}:t.x={value:e.config().scale.textBandWidth/2},e.has(i.Y)?t.y={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_mid"})}:t.y={value:e.config().scale.bandSize/2},e.has(i.SIZE)?t.fontSize={scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}:t.fontSize={value:c(e)},!e.config().mark.applyColorToBackground||e.has(i.X)||e.has(i.Y))r.applyColorAndOpacity(t,e);else{t.fill={value:"black"};var a=e.config().mark.opacity;a&&(t.opacity={value:a})}if(e.has(i.TEXT))if(o.contains([u.QUANTITATIVE,u.TEMPORAL],e.fieldDef(i.TEXT).type)){var l=e.config().mark.format;o.extend(t,r.formatMixins(e,i.TEXT,l))}else t.text={field:e.field(i.TEXT)};else n.value&&(t.text={value:n.value});return t}function c(e){var t=e.fieldDef(i.SIZE);return t&&void 0!==t.value?t.value:e.config().mark.fontSize}e.markType=t,e.background=n,e.properties=a}(a=n.text||(n.text={}))},{"../../channel":10,"../../type":42,"../../util":43,"../common":12}],25:[function(e,t,n){var a,i=e("../../channel"),r=e("../common");!function(e){function t(){return"rect"}function n(e){var t={};return e.has(i.X)?t.xc={scale:e.scaleName(i.X),field:e.field(i.X,{binSuffix:"_mid"})}:t.xc={value:e.config().scale.bandSize/2},e.has(i.Y)?t.yc={scale:e.scaleName(i.Y),field:e.field(i.Y,{binSuffix:"_mid"})}:t.yc={value:e.config().scale.bandSize/2},"horizontal"===e.config().mark.orient?(t.width={value:e.config().mark.tickThickness},t.height=e.has(i.SIZE)?{scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}:{value:a(e,i.Y)}):(t.width=e.has(i.SIZE)?{scale:e.scaleName(i.SIZE),field:e.field(i.SIZE)}:{value:a(e,i.X)},t.height={value:e.config().mark.tickThickness}),r.applyColorAndOpacity(t,e),t}function a(e,t){var n=e.fieldDef(i.SIZE);if(n&&void 0!==n.value)return n.value;var a=e.config().scale,r=e.config().mark;if(r.tickSize)return r.tickSize;var o=e.has(t)?e.scale(t).bandSize:a.bandSize;return o/1.5}function o(e){}e.markType=t,e.properties=n,e.labels=o}(a=n.tick||(n.tick={}))},{"../../channel":10,"../common":12}],26:[function(e,t,n){var a=e("../channel"),i=e("../encoding"),r=e("../fielddef"),o=e("../scale"),u=e("../util"),c=function(){function e(){this._nameMap={}}return e.prototype.rename=function(e,t){this._nameMap[e]=t},e.prototype.get=function(e){for(;this._nameMap[e];)e=this._nameMap[e];return e},e}(),l=function(){function e(e,t,n){this._warnings=[],this._parent=t,this._name=e.name||n,this._dataNameMap=t?t._dataNameMap:new c,this._scaleNameMap=t?t._scaleNameMap:new c,this._sizeNameMap=t?t._sizeNameMap:new c,this._data=e.data,this._description=e.description,this._transform=e.transform,this.component={data:null,layout:null,mark:null,scale:null,axis:null,axisGroup:null,gridGroup:null,legend:null}}return e.prototype.parse=function(){this.parseData(),this.parseSelectionData(),this.parseLayoutData(),this.parseScale(),this.parseAxis(),this.parseLegend(),this.parseAxisGroup(),this.parseGridGroup(),this.parseMark()},e.prototype.assembleScales=function(){return u.flatten(u.vals(this.component.scale))},e.prototype.assembleAxes=function(){return u.vals(this.component.axis)},e.prototype.assembleLegends=function(){return u.vals(this.component.legend)},e.prototype.assembleGroup=function(){var e={};e.marks=this.assembleMarks();var t=this.assembleScales();t.length>0&&(e.scales=t);var n=this.assembleAxes();n.length>0&&(e.axes=n);var a=this.assembleLegends();return a.length>0&&(e.legends=a),e},e.prototype.reduce=function(e,t,n){return i.channelMappingReduce(this.channels(),this.mapping(),e,t,n)},e.prototype.forEach=function(e,t){i.channelMappingForEach(this.channels(),this.mapping(),e,t)},e.prototype.parent=function(){return this._parent},e.prototype.name=function(e,t){return void 0===t&&(t="-"),(this._name?this._name+t:"")+e},e.prototype.description=function(){return this._description},e.prototype.data=function(){return this._data},e.prototype.renameData=function(e,t){this._dataNameMap.rename(e,t)},e.prototype.dataName=function(e){return this._dataNameMap.get(this.name(e+""))},e.prototype.renameSize=function(e,t){this._sizeNameMap.rename(e,t)},e.prototype.channelSizeName=function(e){return this.sizeName(e===a.X||e===a.COLUMN?"width":"height")},e.prototype.sizeName=function(e){return this._sizeNameMap.get(this.name(e,"_"))},e.prototype.transform=function(){return this._transform||{}},e.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=u.extend({binSuffix:this.scale(e).type===o.ScaleType.ORDINAL?"_range":"_start"},t)),r.field(n,t)},e.prototype.scale=function(e){return this._scale[e]},e.prototype.isOrdinalScale=function(e){var t=this.scale(e);return t&&t.type===o.ScaleType.ORDINAL},e.prototype.renameScale=function(e,t){this._scaleNameMap.rename(e,t)},e.prototype.scaleName=function(e){return this._scaleNameMap.get(this.name(e+""))},e.prototype.sort=function(e){return(this.mapping()[e]||{}).sort},e.prototype.axis=function(e){return this._axis[e]},e.prototype.legend=function(e){return this._legend[e]},e.prototype.config=function(){return this._config},e.prototype.addWarning=function(e){this._warnings.push(e)},e.prototype.warnings=function(){return this._warnings},e}();n.Model=l},{"../channel":10,"../encoding":33,"../fielddef":34,"../scale":37,"../util":43}],27:[function(e,t,n){function a(e){return e.channels().reduce(function(t,n){if(e.scale(n)){var a=e.fieldDef(n),u=[];n===v.COLOR&&e.legend(v.COLOR)&&(a.type===L.ORDINAL||a.bin||a.timeUnit)&&(u.push(r(e,a)),a.bin&&u.push(o(e,a))),u.push(i(e,a,n)),t[n]=u}return t},{})}function i(e,t,a){var i=e.scale(a),r=e.sort(a),o={name:e.scaleName(a),type:i.type};return o.domain=c(i,e,a),C.extend(o,f(i,e,a)),r&&"descending"===("string"==typeof r?r:r.order)&&(o.reverse=!0),["round","clamp","nice","exponent","zero","padding","points"].forEach(function(r){var u=n[r](i,a,t,e);void 0!==u&&(o[r]=u)}),o}function r(e,t){return{name:e.scaleName(n.COLOR_LEGEND),type:"ordinal",domain:{data:e.dataTable(),field:e.field(v.COLOR,t.bin||t.timeUnit?{}:{prefn:"rank_"}),sort:!0},range:{data:e.dataTable(),field:e.field(v.COLOR),sort:!0}}}function o(e,t){return{name:e.scaleName(n.COLOR_LEGEND_LABEL),type:"ordinal",domain:{data:e.dataTable(),field:e.field(v.COLOR),sort:!0},range:{data:e.dataTable(),field:A.field(t,{binSuffix:"_range"}),sort:{field:e.field(v.COLOR,{binSuffix:"_start"}),op:"min"}}}}function u(e,t,n,a){if(!v.hasScale(n))return null;if(C.contains([v.ROW,v.COLUMN,v.SHAPE],n))return M.ScaleType.ORDINAL;if(void 0!==e.type)return e.type;switch(t.type){case L.NOMINAL:return M.ScaleType.ORDINAL;case L.ORDINAL:return n===v.COLOR?M.ScaleType.LINEAR:M.ScaleType.ORDINAL;case L.TEMPORAL:if(n===v.COLOR)return M.ScaleType.TIME;if(t.timeUnit)switch(t.timeUnit){case R.TimeUnit.HOURS:case R.TimeUnit.DAY:case R.TimeUnit.MONTH:return M.ScaleType.ORDINAL;default:return M.ScaleType.TIME}return M.ScaleType.TIME;case L.QUANTITATIVE:return t.bin?C.contains([v.X,v.Y,v.COLOR],n)?M.ScaleType.LINEAR:M.ScaleType.ORDINAL:M.ScaleType.LINEAR}return null}function c(e,t,n){var a=t.fieldDef(n);if(e.domain)return e.domain;if(a.type===L.TEMPORAL)return x.rawDomain(a.timeUnit,n)?{data:a.timeUnit,field:"date"}:{data:t.dataTable(),field:t.field(n),sort:{field:t.field(n),op:"min"}};var i=t.stack();if(i&&n===i.fieldChannel)return i.offset===E.StackOffset.NORMALIZE?[0,1]:{data:t.dataName(S.STACKED_SCALE),field:t.field(n,{prefn:"sum_"})};var r=s(e,t,n),o=l(t,n,e.type);return r?{data:S.SOURCE,field:t.field(n,{noAggregate:!0})}:a.bin?e.type===M.ScaleType.ORDINAL?{data:t.dataTable(),field:t.field(n,{binSuffix:"_range"}),sort:{field:t.field(n,{binSuffix:"_start"}),op:"min"}}:n===v.COLOR?{data:t.dataTable(),field:t.field(n,{binSuffix:"_start"})}:{data:t.dataTable(),field:[t.field(n,{binSuffix:"_start"}),t.field(n,{binSuffix:"_end"})]}:o?{data:o.op?S.SOURCE:t.dataTable(),field:a.type===L.ORDINAL&&n===v.COLOR?t.field(n,{prefn:"rank_"}):t.field(n),sort:o}:{data:t.dataTable(),field:a.type===L.ORDINAL&&n===v.COLOR?t.field(n,{prefn:"rank_"}):t.field(n)}}function l(e,t,n){if(n===M.ScaleType.ORDINAL){var a=e.sort(t);return C.contains(["ascending","descending",void 0],a)?!0:"string"!=typeof a?{op:a.op,field:a.field}:void 0}}function s(e,t,n){var a=t.fieldDef(n);return e.includeRawDomain&&a.aggregate&&T.SHARED_DOMAIN_OPS.indexOf(a.aggregate)>=0&&(a.type===L.QUANTITATIVE&&!a.bin||a.type===L.TEMPORAL&&C.contains([M.ScaleType.TIME,M.ScaleType.UTC],e.type));
}function f(e,t,n){var a=t.fieldDef(n),i=t.config().scale;if(e.type===M.ScaleType.ORDINAL&&e.bandSize&&C.contains([v.X,v.Y],n))return{bandSize:e.bandSize};if(e.range&&!C.contains([v.X,v.Y,v.ROW,v.COLUMN],n))return{range:e.range};switch(n){case v.ROW:return{range:"height"};case v.COLUMN:return{range:"width"}}var r=t;switch(n){case v.X:return{rangeMin:0,rangeMax:r.cellWidth()};case v.Y:return{rangeMin:r.cellHeight(),rangeMax:0};case v.SIZE:if(r.mark()===N.BAR){if(void 0!==i.barSizeRange)return{range:i.barSizeRange};var o="horizontal"===t.config().mark.orient?v.Y:v.X;return{range:[t.config().mark.barThinSize,t.scale(o).bandSize]}}if(r.mark()===N.TEXT)return{range:i.fontSizeRange};if(void 0!==i.pointSizeRange)return{range:i.pointSizeRange};var u=A.isMeasure(r.encoding().x),c=A.isMeasure(r.encoding().y),l=u!==c?t.scale(u?v.Y:v.X).bandSize:Math.min(t.scale(v.X).bandSize||i.bandSize,t.scale(v.Y).bandSize||i.bandSize);return{range:[9,(l-2)*(l-2)]};case v.SHAPE:return{range:i.shapeRange};case v.COLOR:return a.type===L.NOMINAL?{range:i.nominalColorRange}:{range:i.sequentialColorRange}}return{}}function d(e){return C.contains([M.ScaleType.LINEAR,M.ScaleType.POW,M.ScaleType.SQRT,M.ScaleType.LOG,M.ScaleType.TIME,M.ScaleType.UTC],e.type)?e.clamp:void 0}function p(e){return e.type===M.ScaleType.POW?e.exponent:void 0}function m(e,t,n){return C.contains([M.ScaleType.LINEAR,M.ScaleType.POW,M.ScaleType.SQRT,M.ScaleType.LOG,M.ScaleType.TIME,M.ScaleType.UTC,M.ScaleType.QUANTIZE],e.type)?void 0!==e.nice?e.nice:C.contains([M.ScaleType.TIME,M.ScaleType.UTC],e.type)?x.smallestUnit(n.timeUnit):C.contains([v.X,v.Y],t):void 0}function h(e,t){return e.type===M.ScaleType.ORDINAL&&C.contains([v.X,v.Y],t)?e.padding:void 0}function g(e,t,n,a){return e.type===M.ScaleType.ORDINAL&&C.contains([v.X,v.Y],t)?!0:void 0}function y(e,t){return C.contains([v.X,v.Y,v.ROW,v.COLUMN,v.SIZE],t)&&void 0!==e.round?e.round:void 0}function O(e,t,n){return C.contains([M.ScaleType.TIME,M.ScaleType.UTC,M.ScaleType.ORDINAL],e.type)?void 0:void 0!==e.zero?e.zero:!n.bin&&C.contains([v.X,v.Y],t)}var T=e("../aggregate"),v=e("../channel"),E=e("../config"),S=e("../data"),A=e("../fielddef"),N=e("../mark"),M=e("../scale"),R=e("../timeunit"),L=e("../type"),C=e("../util"),x=e("./time");n.COLOR_LEGEND="color_legend",n.COLOR_LEGEND_LABEL="color_legend_label",n.parseScaleComponent=a,n.scaleType=u,n.domain=c,n.domainSort=l,n.rangeMixins=f,n.clamp=d,n.exponent=p,n.nice=m,n.padding=h,n.points=g,n.round=y,n.zero=O},{"../aggregate":7,"../channel":10,"../config":31,"../data":32,"../fielddef":34,"../mark":36,"../scale":37,"../timeunit":41,"../type":42,"../util":43,"./time":29}],28:[function(e,t,n){function a(e,t,n,a){var r=i(e,t,n);if(r.length>0&&p.contains([s.BAR,s.AREA],e)&&a.mark.stacked!==l.StackOffset.NONE&&d.isAggregate(t)){var o=d.has(t,u.X)&&f.isMeasure(t.x),c=d.has(t,u.Y)&&f.isMeasure(t.y);if(o&&!c)return{groupbyChannel:u.Y,fieldChannel:u.X,stackFields:r,offset:a.mark.stacked};if(c&&!o)return{groupbyChannel:u.X,fieldChannel:u.Y,stackFields:r,offset:a.mark.stacked}}return null}function i(e,t,n){return[u.COLOR,u.DETAIL].reduce(function(e,a){var i=t[a];if(d.has(t,a))if(p.isArray(i))i.forEach(function(t){e.push(f.field(t))});else{var r=i,o=n[a];e.push(f.field(r,{binSuffix:o&&o.type===c.ScaleType.ORDINAL?"_range":"_start"}))}return e},[])}function r(e){var t=e.stack();return{type:"impute",field:e.field(t.fieldChannel),groupby:t.stackFields,orderby:[e.field(t.groupbyChannel)],method:"value",value:0}}function o(e){var t=e.stack(),n=e.encoding(),a=e.has(u.ORDER)?(p.isArray(n[u.ORDER])?n[u.ORDER]:[n[u.ORDER]]).map(m.sortField):t.stackFields.map(function(e){return"-"+e}),i=e.field(t.fieldChannel),r={type:"stack",groupby:[e.field(t.groupbyChannel)],field:e.field(t.fieldChannel),sortby:a,output:{start:i+"_start",end:i+"_end"}};return t.offset&&(r.offset=t.offset),r}var u=e("../channel"),c=e("../scale"),l=e("../config"),s=e("../mark"),f=e("../fielddef"),d=e("../encoding"),p=e("../util"),m=e("./common");n.compileStackProperties=a,n.imputeTransform=r,n.stackTransform=o},{"../channel":10,"../config":31,"../encoding":33,"../fielddef":34,"../mark":36,"../scale":37,"../util":43,"./common":12}],29:[function(e,t,n){function a(e){return e?e.indexOf("second")>-1?"second":e.indexOf("minute")>-1?"minute":e.indexOf("hour")>-1?"hour":e.indexOf("day")>-1||e.indexOf("date")>-1?"day":e.indexOf("month")>-1?"month":e.indexOf("year")>-1?"year":void 0:void 0}function i(e,t,n){function a(e,a){return void 0===a&&(a=!0),n?t+(a?", ":""):e+"("+t+")"+(a?", ":"")}void 0===n&&(n=!1);var i="datetime(",r=e.toString();return i+=r.indexOf("year")>-1?a("year"):"2006, ",i+=r.indexOf("month")>-1?a("month"):"0, ",i+=r.indexOf("day")>-1?a("day",!1)+"+1, ":r.indexOf("date")>-1?a("date"):"1, ",i+=r.indexOf("hours")>-1?a("hours"):"0, ",i+=r.indexOf("minutes")>-1?a("minutes"):"0, ",i+=r.indexOf("seconds")>-1?a("seconds"):"0, ",i+=r.indexOf("milliseconds")>-1?a("milliseconds",!1):"0",i+")"}function r(e,t){if(o.contains([u.ROW,u.COLUMN,u.SHAPE,u.COLOR],t))return null;switch(e){case c.TimeUnit.SECONDS:return o.range(0,60);case c.TimeUnit.MINUTES:return o.range(0,60);case c.TimeUnit.HOURS:return o.range(0,24);case c.TimeUnit.DAY:return o.range(0,7);case c.TimeUnit.DATE:return o.range(1,32);case c.TimeUnit.MONTH:return o.range(0,12)}return null}var o=e("../util"),u=e("../channel"),c=e("../timeunit");n.smallestUnit=a,n.parseExpression=i,n.rawDomain=r},{"../channel":10,"../timeunit":41,"../util":43}],30:[function(e,t,n){var a=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../aggregate"),r=e("../channel"),o=e("../config"),u=e("../data"),c=e("../encoding"),l=e("../fielddef"),s=e("../mark"),f=e("../scale"),d=e("../type"),p=e("../util"),m=e("./axis"),h=e("./common"),g=e("./config"),y=e("./data"),O=e("./legend"),T=e("./layout"),v=e("./model"),E=e("./mark/mark"),S=e("./scale"),A=e("./stack"),N=function(e){function t(t,n,a){e.call(this,t,n,a);var i=this._mark=t.mark,r=this._encoding=this._initEncoding(i,t.encoding||{}),o=this._config=this._initConfig(t.config,n,i,r),u=this._scale=this._initScale(i,r,o);this._axis=this._initAxis(r,o),this._legend=this._initLegend(r,o),this._stack=A.compileStackProperties(i,r,u,o)}return a(t,e),t.prototype._initEncoding=function(e,t){return t=p.duplicate(t),c.forEach(t,function(t,n){return r.supportMark(n,e)?(t.type&&(t.type=d.getFullName(t.type)),void(n!==r.PATH&&n!==r.ORDER||t.aggregate||t.type!==d.QUANTITATIVE||(t.aggregate=i.AggregateOp.MIN))):(console.warn(n,"dropped as it is incompatible with",e),void delete t.field)}),t},t.prototype._initConfig=function(e,t,n,a){var i=p.mergeDeep(p.duplicate(o.defaultConfig),e,t?t.config():{});return i.mark=g.initMarkConfig(n,a,i),i},t.prototype._initScale=function(e,t,n){return r.UNIT_SCALE_CHANNELS.reduce(function(a,i){if(c.has(t,i)){var o=t[i].scale||{},u=t[i],l=S.scaleType(o,u,i,e);a[i]=p.extend({type:l,round:n.scale.round,padding:n.scale.padding,includeRawDomain:n.scale.includeRawDomain,bandSize:i===r.X&&l===f.ScaleType.ORDINAL&&e===s.TEXT?n.scale.textBandWidth:n.scale.bandSize},o)}return a},{})},t.prototype._initAxis=function(e,t){return[r.X,r.Y].reduce(function(n,a){if(c.has(e,a)){var i=e[a].axis;i!==!1&&(n[a]=p.extend({},t.axis,i===!0?{}:i||{}))}return n},{})},t.prototype._initLegend=function(e,t){return r.NONSPATIAL_SCALE_CHANNELS.reduce(function(n,a){if(c.has(e,a)){var i=e[a].legend;i!==!1&&(n[a]=p.extend({},t.legend,i===!0?{}:i||{}))}return n},{})},t.prototype.parseData=function(){this.component.data=y.parseUnitData(this)},t.prototype.parseSelectionData=function(){},t.prototype.parseLayoutData=function(){this.component.layout=T.parseUnitLayout(this)},t.prototype.parseScale=function(){this.component.scale=S.parseScaleComponent(this)},t.prototype.parseMark=function(){this.component.mark=E.parseMark(this)},t.prototype.parseAxis=function(){this.component.axis=m.parseAxisComponent(this,[r.X,r.Y])},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){this.component.legend=O.parseLegendComponent(this)},t.prototype.assembleData=function(e){return y.assembleData(this,e)},t.prototype.assembleLayout=function(e){return T.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return this.component.mark},t.prototype.assembleParentGroupProperties=function(e){return h.applyConfig({},e,h.FILL_STROKE_CONFIG.concat(["clip"]))},t.prototype.channels=function(){return r.UNIT_CHANNELS},t.prototype.mapping=function(){return this.encoding()},t.prototype.stack=function(){return this._stack},t.prototype.toSpec=function(e,t){var n,a=p.duplicate(this._encoding);return n={mark:this._mark,encoding:a},e||(n.config=p.duplicate(this._config)),t||(n.data=p.duplicate(this._data)),n},t.prototype.cellWidth=function(){return(this.isFacet()?this.config().facet.cell.width:null)||this.config().cell.width},t.prototype.cellHeight=function(){return(this.isFacet()?this.config().facet.cell.height:null)||this.config().cell.height},t.prototype.mark=function(){return this._mark},t.prototype.has=function(e){return c.has(this._encoding,e)},t.prototype.encoding=function(){return this._encoding},t.prototype.fieldDef=function(e){return this._encoding[e]||{}},t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=p.extend({binSuffix:this.scale(e).type===f.ScaleType.ORDINAL?"_range":"_start"},t)),l.field(n,t)},t.prototype.isFacet=function(){return this.has(r.ROW)||this.has(r.COLUMN)},t.prototype.dataTable=function(){return(c.isAggregate(this._encoding)?u.SUMMARY:u.SOURCE)+""},t}(v.Model);n.UnitModel=N},{"../aggregate":7,"../channel":10,"../config":31,"../data":32,"../encoding":33,"../fielddef":34,"../mark":36,"../scale":37,"../type":42,"../util":43,"./axis":11,"./common":12,"./config":14,"./data":15,"./layout":17,"./legend":18,"./mark/mark":22,"./model":26,"./scale":27,"./stack":28}],31:[function(e,t,n){var a=e("./scale"),i=e("./axis"),r=e("./legend");n.defaultCellConfig={width:200,height:200},n.defaultFacetCellConfig={stroke:"#ccc",strokeWidth:1};var o={color:"#000000",opacity:.4,offset:0};n.defaultFacetConfig={scale:a.defaultFacetScaleConfig,axis:i.defaultFacetAxisConfig,grid:o,cell:n.defaultFacetCellConfig},function(e){e[e.NORMAL="normal"]="NORMAL",e[e.BOLD="bold"]="BOLD"}(n.FontWeight||(n.FontWeight={}));n.FontWeight;!function(e){e[e.CIRCLE="circle"]="CIRCLE",e[e.SQUARE="square"]="SQUARE",e[e.CROSS="cross"]="CROSS",e[e.DIAMOND="diamond"]="DIAMOND",e[e.TRIANGLEUP="triangle-up"]="TRIANGLEUP",e[e.TRIANGLEDOWN="triangle-down"]="TRIANGLEDOWN"}(n.Shape||(n.Shape={}));n.Shape;!function(e){e[e.LEFT="left"]="LEFT",e[e.RIGHT="right"]="RIGHT",e[e.CENTER="center"]="CENTER"}(n.HorizontalAlign||(n.HorizontalAlign={}));n.HorizontalAlign;!function(e){e[e.TOP="top"]="TOP",e[e.MIDDLE="middle"]="MIDDLE",e[e.BOTTOM="bottom"]="BOTTOM"}(n.VerticalAlign||(n.VerticalAlign={}));var u=n.VerticalAlign;!function(e){e[e.NORMAL="normal"]="NORMAL",e[e.ITALIC="italic"]="ITALIC"}(n.FontStyle||(n.FontStyle={}));n.FontStyle;!function(e){e[e.ZERO="zero"]="ZERO",e[e.CENTER="center"]="CENTER",e[e.NORMALIZE="normalize"]="NORMALIZE",e[e.NONE="none"]="NONE"}(n.StackOffset||(n.StackOffset={}));n.StackOffset;n.defaultMarkConfig={color:"#4682b4",strokeWidth:2,size:30,barThinSize:2,tickThickness:1,fontSize:10,baseline:u.MIDDLE,text:"Abc",shortTimeLabels:!1,applyColorToBackground:!1},n.defaultConfig={numberFormat:"s",timeFormat:"%Y-%m-%d",cell:n.defaultCellConfig,mark:n.defaultMarkConfig,scale:a.defaultScaleConfig,axis:i.defaultAxisConfig,legend:r.defaultLegendConfig,facet:n.defaultFacetConfig}},{"./axis":8,"./legend":35,"./scale":37}],32:[function(e,t,n){var a=e("./type");!function(e){e[e.JSON="json"]="JSON",e[e.CSV="csv"]="CSV",e[e.TSV="tsv"]="TSV"}(n.DataFormat||(n.DataFormat={}));n.DataFormat;!function(e){e[e.SOURCE="source"]="SOURCE",e[e.SUMMARY="summary"]="SUMMARY",e[e.STACKED_SCALE="stacked_scale"]="STACKED_SCALE",e[e.LAYOUT="layout"]="LAYOUT"}(n.DataTable||(n.DataTable={}));var i=n.DataTable;n.SUMMARY=i.SUMMARY,n.SOURCE=i.SOURCE,n.STACKED_SCALE=i.STACKED_SCALE,n.LAYOUT=i.LAYOUT,n.types={"boolean":a.Type.NOMINAL,number:a.Type.QUANTITATIVE,integer:a.Type.QUANTITATIVE,date:a.Type.TEMPORAL,string:a.Type.NOMINAL}},{"./type":42}],33:[function(e,t,n){function a(e){var t=0;return e.color&&t++,e.size&&t++,e.shape&&t++,t}function i(e){return m.CHANNELS.filter(function(t){return r(e,t)})}function r(e,t){var n=e&&e[t];return n&&(void 0!==n.field||h.isArray(n)&&n.length>0)}function o(e){return h.any(m.CHANNELS,function(t){return!(!r(e,t)||!e[t].aggregate)})}function u(e){var t=[];return m.CHANNELS.forEach(function(n){r(e,n)&&(h.isArray(e[n])?e[n].forEach(function(e){t.push(e)}):t.push(e[n]))}),t}function c(e,t,n){l(m.CHANNELS,e,t,n)}function l(e,t,n,a){var i=0;e.forEach(function(e){r(t,e)&&(h.isArray(t[e])?t[e].forEach(function(t){n.call(a,t,e,i++)}):n.call(a,t[e],e,i++))})}function s(e,t,n){return f(m.CHANNELS,e,t,n)}function f(e,t,n,a){var i=[];return e.forEach(function(e){r(t,e)&&(h.isArray(t[e])?t[e].forEach(function(t){i.push(n.call(a,t,e))}):i.push(n.call(a,t[e],e)))}),i}function d(e,t,n,a){return p(m.CHANNELS,e,t,n,a)}function p(e,t,n,a,i){var o=a;return m.CHANNELS.forEach(function(e){r(t,e)&&(h.isArray(t[e])?t[e].forEach(function(t){o=n.call(i,o,t,e)}):o=n.call(i,o,t[e],e))}),o}var m=e("./channel"),h=e("./util");n.countRetinal=a,n.channels=i,n.has=r,n.isAggregate=o,n.fieldDefs=u,n.forEach=c,n.channelMappingForEach=l,n.map=s,n.channelMappingMap=f,n.reduce=d,n.channelMappingReduce=p},{"./channel":10,"./util":43}],34:[function(e,t,n){function a(e,t){void 0===t&&(t={});var n=(t.datum?"datum.":"")+(t.prefn||""),a=t.suffix||"",i=e.field;return c(e)?n+"count"+a:t.fn?n+t.fn+"_"+i+a:!t.nofn&&e.bin?n+"bin_"+i+(t.binSuffix||a||"_start"):t.nofn||t.noAggregate||!e.aggregate?!t.nofn&&e.timeUnit?n+e.timeUnit+"_"+i+a:n+i:n+e.aggregate+"_"+i+a}function i(e){return m.contains([p.NOMINAL,p.ORDINAL],e.type)||!!e.bin||e.type===p.TEMPORAL&&!!e.timeUnit}function r(e){return e&&e.field&&i(e)}function o(e){return e&&e.field&&!i(e)}function u(){return{field:"*",aggregate:f.AggregateOp.COUNT,type:p.QUANTITATIVE,displayName:n.COUNT_DISPLAYNAME}}function c(e){return e.aggregate===f.AggregateOp.COUNT}function l(e,t,n){void 0===n&&(n={});var a=t[e.field],i=e.type;if(e.bin){var r=e.bin,o="boolean"==typeof r?void 0:r.maxbins;void 0===o&&(o=10);var u=m.getbins(a,o);return(u.stop-u.start)/u.step}if(i===p.TEMPORAL){var c=e.timeUnit;switch(c){case d.TimeUnit.SECONDS:return 60;case d.TimeUnit.MINUTES:return 60;case d.TimeUnit.HOURS:return 24;case d.TimeUnit.DAY:return 7;case d.TimeUnit.DATE:return 31;case d.TimeUnit.MONTH:return 12;case d.TimeUnit.YEAR:var l=t["year_"+e.field];return l?l.distinct-(a.missing>0&&n[i]?1:0):null}}return e.aggregate?1:a.distinct-(a.missing>0&&n[i]?1:0)}function s(e){if(c(e))return n.COUNT_DISPLAYNAME;var t=e.aggregate||e.timeUnit||e.bin&&"bin";return t?t.toString().toUpperCase()+"("+e.field+")":e.field}var f=e("./aggregate"),d=e("./timeunit"),p=e("./type"),m=e("./util");n.aggregate={type:"string","enum":f.AGGREGATE_OPS,supportedEnums:{quantitative:f.AGGREGATE_OPS,ordinal:["median","min","max"],nominal:[],temporal:["mean","median","min","max"],"":["count"]},supportedTypes:m.toMap([p.QUANTITATIVE,p.NOMINAL,p.ORDINAL,p.TEMPORAL,""])},n.field=a,n.isDimension=r,n.isMeasure=o,n.COUNT_DISPLAYNAME="Number of Records",n.count=u,n.isCount=c,n.cardinality=l,n.title=s},{"./aggregate":7,"./timeunit":41,"./type":42,"./util":43}],35:[function(e,t,n){n.defaultLegendConfig={orient:void 0,shortTimeLabels:!1}},{}],36:[function(e,t,n){!function(e){e[e.AREA="area"]="AREA",e[e.BAR="bar"]="BAR",e[e.LINE="line"]="LINE",e[e.POINT="point"]="POINT",e[e.TEXT="text"]="TEXT",e[e.TICK="tick"]="TICK",e[e.CIRCLE="circle"]="CIRCLE",e[e.SQUARE="square"]="SQUARE"}(n.Mark||(n.Mark={}));var a=n.Mark;n.AREA=a.AREA,n.BAR=a.BAR,n.LINE=a.LINE,n.POINT=a.POINT,n.TEXT=a.TEXT,n.TICK=a.TICK,n.CIRCLE=a.CIRCLE,n.SQUARE=a.SQUARE},{}],37:[function(e,t,n){!function(e){e[e.LINEAR="linear"]="LINEAR",e[e.LOG="log"]="LOG",e[e.POW="pow"]="POW",e[e.SQRT="sqrt"]="SQRT",e[e.QUANTILE="quantile"]="QUANTILE",e[e.QUANTIZE="quantize"]="QUANTIZE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TIME="time"]="TIME",e[e.UTC="utc"]="UTC"}(n.ScaleType||(n.ScaleType={}));n.ScaleType;!function(e){e[e.SECOND="second"]="SECOND",e[e.MINUTE="minute"]="MINUTE",e[e.HOUR="hour"]="HOUR",e[e.DAY="day"]="DAY",e[e.WEEK="week"]="WEEK",e[e.MONTH="month"]="MONTH",e[e.YEAR="year"]="YEAR"}(n.NiceTime||(n.NiceTime={}));n.NiceTime;n.defaultScaleConfig={round:!0,textBandWidth:90,bandSize:21,padding:1,includeRawDomain:!1,nominalColorRange:"category10",sequentialColorRange:["#AFC6A3","#09622A"],shapeRange:"shapes",fontSizeRange:[8,40]},n.defaultFacetScaleConfig={round:!0,padding:16}},{}],38:[function(e,t,n){function a(e){return"mark"+n.ASSIGN+e.mark+n.DELIM+r(e.encoding)}function i(e,t,a){var i=e.split(n.DELIM),r=i.shift().split(n.ASSIGN)[1].trim(),u=o(i.join(n.DELIM)),c={mark:m.Mark[r],encoding:u};return void 0!==t&&(c.data=t),void 0!==a&&(c.config=a),c}function r(e){return p.map(e,function(e,t){return t+n.ASSIGN+u(e)}).join(n.DELIM)}function o(e){return e.split(n.DELIM).reduce(function(e,t){var a=t.split(n.ASSIGN),i=a[0].trim(),r=a[1];return e[i]=l(r),e},{})}function u(e){return(e.aggregate?e.aggregate+n.FUNC:"")+(e.timeUnit?e.timeUnit+n.FUNC:"")+(e.bin?"bin"+n.FUNC:"")+(e.field||"")+n.TYPE+d.SHORT_TYPE[e.type]}function c(e,t){return void 0===t&&(t=n.DELIM),e.map(u).join(t)}function l(e){for(var t=e.split(n.TYPE),a={field:t[0].trim(),type:d.TYPE_FROM_SHORT_TYPE[t[1].trim()]},i=0;i<s.AGGREGATE_OPS.length;i++){var r=s.AGGREGATE_OPS[i];if(0===a.field.indexOf(r+"_")){a.field=a.field.substr(r.toString().length+1),r===s.AggregateOp.COUNT&&0===a.field.length&&(a.field="*"),a.aggregate=r;break}}for(var i=0;i<f.TIMEUNITS.length;i++){var o=f.TIMEUNITS[i];if(a.field&&0===a.field.indexOf(o+"_")){a.field=a.field.substr(a.field.length+1),a.timeUnit=o;break}}return a.field&&0===a.field.indexOf("bin_")&&(a.field=a.field.substr(4),a.bin=!0),a}var s=e("./aggregate"),f=e("./timeunit"),d=e("./type"),p=e("./encoding"),m=e("./mark");n.DELIM="|",n.ASSIGN="=",n.TYPE=",",n.FUNC="_",n.shorten=a,n.parse=i,n.shortenEncoding=r,n.parseEncoding=o,n.shortenFieldDef=u,n.shortenFieldDefs=c,n.parseFieldDef=l},{"./aggregate":7,"./encoding":33,"./mark":36,"./timeunit":41,"./type":42}],39:[function(e,t,n){!function(e){e[e.ASCENDING="ascending"]="ASCENDING",e[e.DESCENDING="descending"]="DESCENDING",e[e.NONE="none"]="NONE"}(n.SortOrder||(n.SortOrder={}));n.SortOrder},{}],40:[function(e,t,n){function a(e){var t=l.has(e.encoding,s.ROW),n=l.has(e.encoding,s.COLUMN);if(t||n){var a=p.duplicate(e.encoding);return delete a.column,delete a.row,p.extend(e.name?{name:e.name}:{},e.description?{description:e.description}:{},{data:e.data},e.transform?{transform:e.transform}:{},{facet:p.extend(t?{row:e.encoding.row}:{},n?{column:e.encoding.column}:{}),spec:{mark:e.mark,encoding:a}},e.config?{config:e.config}:{})}return e}function i(e){return f.isAggregate(e.encoding)}function r(e){return f.fieldDefs(e.encoding)}function o(e){return e}function u(e){return(f.has(e.encoding,s.COLOR)||f.has(e.encoding,s.SHAPE))&&(e.mark===d.BAR||e.mark===d.AREA)&&(!e.config||!e.config.mark.stacked!=!1)&&f.isAggregate(e.encoding)}function c(e){var t=e.encoding,n=p.duplicate(e.encoding);return n.x=t.y,n.y=t.x,n.row=t.column,n.column=t.row,e.encoding=n,e}var l=e("./encoding"),s=e("./channel"),f=e("./encoding"),d=e("./mark"),p=e("./util");n.normalize=a,n.alwaysNoOcclusion=i,n.fieldDefs=r,n.getCleanSpec=o,n.isStack=u,n.transpose=c},{"./channel":10,"./encoding":33,"./mark":36,"./util":43}],41:[function(e,t,n){function a(e,t){if(void 0===t&&(t=!1),e){var n=e.toString(),a=[];n.indexOf("year")>-1&&a.push(t?"%y":"%Y"),n.indexOf("month")>-1&&a.push(t?"%b":"%B"),n.indexOf("day")>-1?a.push(t?"%a":"%A"):n.indexOf("date")>-1&&a.push("%d");var i=[];n.indexOf("hours")>-1&&i.push("%H"),n.indexOf("minutes")>-1&&i.push("%M"),n.indexOf("seconds")>-1&&i.push("%S"),n.indexOf("milliseconds")>-1&&i.push("%L");var r=[];return a.length>0&&r.push(a.join("-")),i.length>0&&r.push(i.join(":")),r.length>0?r.join(" "):void 0}}!function(e){e[e.YEAR="year"]="YEAR",e[e.MONTH="month"]="MONTH",e[e.DAY="day"]="DAY",e[e.DATE="date"]="DATE",e[e.HOURS="hours"]="HOURS",e[e.MINUTES="minutes"]="MINUTES",e[e.SECONDS="seconds"]="SECONDS",e[e.MILLISECONDS="milliseconds"]="MILLISECONDS",e[e.YEARMONTH="yearmonth"]="YEARMONTH",e[e.YEARMONTHDAY="yearmonthday"]="YEARMONTHDAY",e[e.YEARMONTHDATE="yearmonthdate"]="YEARMONTHDATE",e[e.YEARDAY="yearday"]="YEARDAY",e[e.YEARDATE="yeardate"]="YEARDATE",e[e.YEARMONTHDAYHOURS="yearmonthdayhours"]="YEARMONTHDAYHOURS",e[e.YEARMONTHDAYHOURSMINUTES="yearmonthdayhoursminutes"]="YEARMONTHDAYHOURSMINUTES",e[e.YEARMONTHDAYHOURSMINUTESSECONDS="yearmonthdayhoursminutesseconds"]="YEARMONTHDAYHOURSMINUTESSECONDS",e[e.HOURSMINUTES="hoursminutes"]="HOURSMINUTES",e[e.HOURSMINUTESSECONDS="hoursminutesseconds"]="HOURSMINUTESSECONDS",e[e.MINUTESSECONDS="minutesseconds"]="MINUTESSECONDS",e[e.SECONDSMILLISECONDS="secondsmilliseconds"]="SECONDSMILLISECONDS"}(n.TimeUnit||(n.TimeUnit={}));var i=n.TimeUnit;n.TIMEUNITS=[i.YEAR,i.MONTH,i.DAY,i.DATE,i.HOURS,i.MINUTES,i.SECONDS,i.MILLISECONDS,i.YEARMONTH,i.YEARMONTHDAY,i.YEARMONTHDATE,i.YEARDAY,i.YEARDATE,i.YEARMONTHDAYHOURS,i.YEARMONTHDAYHOURSMINUTES,i.YEARMONTHDAYHOURSMINUTESSECONDS,i.HOURSMINUTES,i.HOURSMINUTESSECONDS,i.MINUTESSECONDS,i.SECONDSMILLISECONDS],n.format=a},{}],42:[function(e,t,n){function a(e){var t=e;return n.TYPE_FROM_SHORT_TYPE[t.toUpperCase()]||t.toLowerCase()}!function(e){e[e.QUANTITATIVE="quantitative"]="QUANTITATIVE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TEMPORAL="temporal"]="TEMPORAL",e[e.NOMINAL="nominal"]="NOMINAL"}(n.Type||(n.Type={}));var i=n.Type;n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.SHORT_TYPE={quantitative:"Q",temporal:"T",nominal:"N",ordinal:"O"},n.TYPE_FROM_SHORT_TYPE={Q:n.QUANTITATIVE,T:n.TEMPORAL,O:n.ORDINAL,N:n.NOMINAL},n.getFullName=a},{}],43:[function(e,t,n){function a(e,t){return e.indexOf(t)>-1}function i(e,t){return e.filter(function(e){return!a(t,e)})}function r(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var a in e)e.hasOwnProperty(a)&&t.call(n,e[a],a,e)}function o(e,t,n,a){if(e.reduce)return e.reduce.call(a,t,n);for(var i in e)e.hasOwnProperty(i)&&(n=t.call(a,n,e[i],i,e));return n}function u(e,t,n){if(e.map)return e.map.call(n,t);var a=[];for(var i in e)e.hasOwnProperty(i)&&a.push(t.call(n,e[i],i,e));return a}function c(e,t){for(var n=0,a=0;a<e.length;a++)if(t(e[a],a,n++))return!0;return!1}function l(e,t){for(var n=0,a=0;a<e.length;a++)if(!t(e[a],a,n++))return!1;return!0}function s(e){return[].concat.apply([],e)}function f(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var a=0;a<t.length;a++)e=d(e,t[a]);return e}function d(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=f(t[n].constructor===Array?[]:{},t[n]):f(e[n],t[n]));return e}function p(e,t){return T({min:e.min,max:e.max,maxbins:t})}function m(e){console.error("[VL Error]",e)}var h=e("datalib/src/util");n.keys=h.keys,n.extend=h.extend,n.duplicate=h.duplicate,n.isArray=h.isArray,n.vals=h.vals,n.truncate=h.truncate,n.toMap=h.toMap,n.isObject=h.isObject;var g=e("datalib/src/generate");n.range=g.range;var y=e("./encoding");n.has=y.has;var O=e("./channel");n.Channel=O.Channel,n.contains=a,n.without=i,n.forEach=r,n.reduce=o,n.map=u,n.any=c,n.all=l,n.flatten=s,n.mergeDeep=f;var T=e("datalib/src/bins/bins");n.getbins=p,n.error=m},{"./channel":10,"./encoding":33,"datalib/src/bins/bins":3,"datalib/src/generate":4,"datalib/src/util":6}],44:[function(e,t,n){function a(e,t,a){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===a&&(a=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var i=e.mark,o=e.encoding,u=t[i],c=a[i];for(var l in u)if(!(u[l]in o))return'Missing encoding channel "'+u[l]+'" for mark "'+i+'"';for(var s in o)if(!c[s])return'Encoding channel "'+s+'" is not supported by mark type "'+i+'"';return i!==r.BAR||o.x||o.y?null:"Missing both x and y for bar"}var i=e("./util"),r=e("./mark");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:i.toMap(["row","column","x","y","size","color","detail"]),line:i.toMap(["row","column","x","y","color","detail"]),area:i.toMap(["row","column","x","y","color","detail"]),tick:i.toMap(["row","column","x","y","color","detail"]),circle:i.toMap(["row","column","x","y","color","size","detail"]),square:i.toMap(["row","column","x","y","color","size","detail"]),point:i.toMap(["row","column","x","y","color","size","detail","shape"]),text:i.toMap(["row","column","size","color","text"])},n.getEncodingMappingError=a},{"./mark":36,"./util":43}],45:[function(e,t,n){var a=e("./bin"),i=e("./channel"),r=e("./config"),o=e("./data"),u=e("./encoding"),c=e("./fielddef"),l=e("./compile/compile"),s=e("./shorthand"),f=e("./spec"),d=e("./timeunit"),p=e("./type"),m=e("./validate"),h=e("./util");n.bin=a,n.channel=i,n.compile=l.compile,n.config=r,n.data=o,n.encoding=u,n.fieldDef=c,n.shorthand=s,n.spec=f,n.timeUnit=d,n.type=p,n.util=h,n.validate=m,n.version="1.0.8"},{"./bin":9,"./channel":10,"./compile/compile":13,"./config":31,"./data":32,"./encoding":33,"./fielddef":34,"./shorthand":38,"./spec":40,"./timeunit":41,"./type":42,"./util":43,"./validate":44}]},{},[45])(45)});
//# sourceMappingURL=vega-lite.min.js.map
